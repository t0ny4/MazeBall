import{D as vt,S as Ve,M as Pt,a as we,L as St,b as je,T as Ze,c as Se,d as Et,P as pe,e as Dt,f as kt,W as At,g as Ct,C as _e,h as zt,F as Tt,i as _t,A as Rt,j as Ft,G as Ht,R as $t,k as It,l as qe,B as Ot,I as Gt,O as Wt,m as Ut,V as Yt,E as Bt}from"./three-Dk7uvf-h.js";import{N as X,G as Kt}from"./keystrokes-zXtNIVHG.js";import{W as Xt,V as te,C as Vt,B as Ee}from"./planck-D8CQOpC-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();function De(...e){let t,o,r,i;if(e.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),e=[a[0],a[1],a[2]]}s(e);function s(a){const d=l();t=d(" "),o=d(" "),r=d(" "),i=1;for(let p=0;p<a.length;p++)t-=d(a[p]),t<0&&(t+=1),o-=d(a[p]),o<0&&(o+=1),r-=d(a[p]),r<0&&(r+=1)}function l(){let a=4022871197;function d(p){p=p.toString();const D=p.length;for(let b=0;b<D;b++){a+=p.charCodeAt(b);let x=.02519603282416938*a;a=x>>>0,x-=a,x*=a,a=x>>>0,x-=a,a+=x*4294967296}return(a>>>0)*23283064365386963e-26}return d}function f(a){return parseInt(a,10)===a}function u(){const a=2091639*t+i*23283064365386963e-26;return t=o,o=r,r=a-(i=a|0),r}return u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.int32=function(){return u()*4294967296},u.cycle=function(a){a=typeof a>"u"?1:Number(a),a<1&&(a=1);for(let d=0;d<a;d++)u()},u.range=function(a=0,d=0){if(a===0&&d===0)return 0;if(a>d){const p=a;a=d,d=p}return f(a)&&f(d)?Math.floor(u()*(d-a+1))+a:u()*(d-a)+a},u.restart=function(){s(e)},u.seed=function(...a){s(a)},u}const jt={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null,statusBar:null},Zt={get(e,t){if(t in e)return e[t];throw console.error('Cannot read non existent property "'+t+'" from global'),new Error},set(e,t,o){if(t in e)return e[t]=o,!0;throw console.error('Cannot create new property "'+t+'" on global'),new Error},deleteProperty(e,t){throw console.error('Cannot delete property "'+t+'" from global'),new Error}},n=new Proxy(Object.seal(jt),Zt),qt={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,soundsDir:"./sounds/",modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",keySounds:{keyPickup:{filename:"DM-CGS-07.ogg",volume:.4}},keySoundGroups:{},ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],mazeSounds:{locked:{filename:"DM-CGS-10.ogg",volume:.3},dm12:{filename:"DM-CGS-12.ogg",volume:.25},dm26:{filename:"DM-CGS-26.ogg",volume:.4},wallhit:{filename:"DM-CGS-03.ogg",volume:.05}},mazeSoundGroups:{mazeExit:["dm12","dm26"]},controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Qt={get(e,t){if(t in e)return e[t];throw console.error('Cannot read non existent property "'+t+'" from config'),new Error},set(e,t){throw console.error('Cannot write to property "'+t+'" on config'),new Error},deleteProperty(e,t){throw console.error('Cannot delete property "'+t+'" from config'),new Error}},c=new Proxy(Object.freeze(qt),Qt);let T=null,We=0;function Jt(){return T=document.createElement("div"),T.id="statusBar",T.classList.add("status"),document.body.append(T),We=T===null?0:T.clientHeight,We}function ge(...e){T&&(T.innerHTML=e.join(" "))}function Nt(){const o=new Uint8Array(1024);for(let i=0;i<1024;i+=4)o[i]=255,o[i+1]=105,o[i+2]=180,o[i+3]=255;const r=new vt(o,16,16);return r.needsUpdate=!0,r}function eo(){const e=new Ve(.1),t=new Pt({color:16738740});return new we(e,t)}function to(e,t){let o=!1,r=!1;const i=new St;i.onError=s=>{console.warn("Failed to load asset:",s),r=!0},i.onProgress=function(s,l,f){ge("Loaded",Math.floor(l/f*100)+"%")},i.onLoad=()=>{o&&(r&&console.error("LoadingManager: finished loading asset files with errors"),ge(""),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(i):console.warn(s,"has no loadAssets method")}),o=!0}const oo=Math.PI/2,$=De();function no(e,t,o){const r=e<3?3:e|1,i=t<3?3:t|1,s={x:r,z:i},l=o===void 0?Math.random().toString().substring(2):o;$.seed(l);const f={size:s,data:Array.from({length:s.x},()=>Array(s.z).fill(!1)),deadends:[],seed:l},u=io(s);return f.start=u.start,f.start.angle=0,f.end=u.end,f.exit=u.exit,f.data[f.exit.x][f.exit.z]="H",f}function ro(e,t,o){const r=no(e,t,o);Qe(r,r.start.x,r.start.z);const{x:i,z:s}=r.start;let l=0;return r.data[i-1][s]!==!1?l=1:r.data[i][s+1]!==!1?l=2:r.data[i+1][s]!==!1&&(l=3),r.data[r.start.x][r.start.z]="S",r.data[r.end.x][r.end.z]="E",r.start.angle=l*oo,r}function Qe(e,t,o){let r=t===e.end.x&&o===e.end.z;for(;;){const i=[];let s;if(o<e.size.z-3&&e.data[t][o+2]===!1&&i.push([0,1]),t<e.size.x-3&&e.data[t+2][o]===!1&&i.push([1,0]),o>2&&e.data[t][o-2]===!1&&i.push([0,-1]),t>2&&e.data[t-2][o]===!1&&i.push([-1,0]),i.length===0)return r?e.data[t][o]="*":e.data[t][o]===!1&&(e.data[t][o]="D",e.deadends.push({x:t,z:o})),r;if(e.data[t][o]="",i.length===1?[s]=i:s=i[Math.floor($()*i.length)],Qe(e,t+s[0]*2,o+s[1]*2)?(e.data[t+s[0]][o+s[1]]="*",r=!0):e.data[t+s[0]][o+s[1]]="",i.length===1)return r&&(e.data[t][o]="*"),r}}function io(e){const t={},o={};let r=$()>.5,i=$()>.5;t.x=i?1:e.x-2,t.z=r?1:e.z-2;const s=$();s>.5?(r=!r,i=!i):s>.25?r=!r:i=!i,o.x=i?1:e.x-2;const l=i?-1:1;o.z=r?1:e.z-2;const f=r?-1:1,u={...o};return $()>.5?(o.z+=f,o.dir=r?"U":"D"):(o.x+=l,o.dir=i?"L":"R"),{start:t,end:u,exit:o}}let I=0,O=0;function so(){function e(){O+=1}function t(){O-=1}function o(){I-=1}function r(){I+=1}X(c.controlKeys.up,{onPressed:t,onReleased:e}),X(c.controlKeys.down,{onPressed:e,onReleased:t}),X(c.controlKeys.left,{onPressed:o,onReleased:r}),X(c.controlKeys.right,{onPressed:r,onReleased:o})}function ao(e){addEventListener("pointermove",e,!1)}function lo(e){removeEventListener("pointermove",e)}function ke(e,t){if(!c.keys[e]){console.error("Unknown key index: "+e);return}const o=c.keys[e];o.includes(">")?Kt(o,t):X(o,t)}let Z;const C={};function co(){Z=new Xt({gravity:new te(0,0)}),n.physicsWorld=Z,n.physicsWorld.addContactCallback=fo,Z.on("begin-contact",e=>{const t=e.m_nodeA.other.m_userData,o=e.m_nodeB.other.m_userData;if(t===void 0||o===void 0||!C[t]||!C[t][o])return;const r=C[t][o],i=performance.now();i-r.last<250||(r.last=i,r.callback(e))})}function fo(e,t,o){C[e]||(C[e]={}),C[e][t]||(C[e][t]={}),C[e][t].callback=o,C[e][t].last=0}function uo(){Z.step(1/60),Z.clearForces()}const Ue=new te(0,0),se=new je,_=c.ballRadius,Ye=c.minVelocity;let w,Y,le,Je=()=>{console.warn("gUpdateMazePosition not set")};function po(e){new Ze(e).load(c.textureDir+"ball/"+c.ballTextureFile,o=>{le=o,le.colorSpace=Se},void 0,()=>{le=n.errorTexture})}function go(e){typeof e=="function"&&(Je=e),Y=n.physicsWorld.createBody({type:"dynamic",position:Ue,awake:!1,fixedRotation:!0,userData:"ball"}),Y.createFixture({shape:new Vt(Ue,_),restitution:.15,density:.2});const t=new Ve(_),o=new Et({map:le});return w=new we(t,o),w.position.y=_,w.castShadow=!0,n.scene.add(w),[Y,w]}function yo(){if(Y.isAwake()){const i=Y.getLinearVelocity();i.mul(.98),Math.abs(i.x)<Ye&&Math.abs(i.y)<Ye&&(i.x=0,i.y=0)}const e=Y.getPosition(),t=e.y,o=e.x-w.position.x,r=t-w.position.z;return o!==0||r!==0?(w.position.set(e.x,_,t),Je(e.x,_,t),n.firstPersonModeActive||(se.makeRotationZ(-o/_),w.matrix.premultiply(se),se.makeRotationX(r/_),w.matrix.premultiply(se),w.rotation.setFromRotationMatrix(w.matrix)),!0):!1}function ho(){return _}function mo(e){w.visible=!e}let oe,Me,G,ne=0,Ne=()=>{console.warn("gUpdateMazePosition not set")};const xo=new te(0,0),et=Math.PI/4,wo=Math.sin(et),Mo=Math.cos(et);function bo(e){po(e)}function tt(e){typeof e=="function"&&(Ne=e),[Me,oe]=go(e),G=new pe(16769248,c.playerLightLevel),G.castShadow=!1,n.scene.add(G),n.playerLight=G}function Ae(){if(I!==0||O!==0){let t;if(I!==0&&O!==0?t=new te(I*Mo,O*wo):t=new te(I,O),t.mul(c.keyForce),n.firstPersonModeActive){const o=Math.cos(ne),r=Math.sin(ne),i=o*t.x-r*t.y,s=r*t.x+o*t.y;t.x=i,t.y=s}Po(t)}n.playerLight.position.x=oe.position.x,n.playerLight.position.z=oe.position.z;const e=yo();return e&&(n.idleStartMs=0,n.idleMode=!1),!e&&!n.idleMode&&(n.idleStartMs===0?n.idleStartMs=Date.now():Date.now()-n.idleStartMs>c.idleTimeout*1e3&&(n.idleMode=!0)),e}function Lo(e){Me.setLinearVelocity(e)}function ot(e){Lo(xo),vo(e.start.x,e.start.z),ne=-e.start.angle,G.position.set(e.start.x,c.lightYpos,e.start.z),G.intensity=0}function vo(e,t){const o=be();oe.position.set(e,o.y,t),Me.setPosition({x:e,y:t}),Ne(e,o.y,t)}function be(){return oe.position}function nt(){return ho()}function Po(e){Me.applyForceToCenter(e)}function rt(){return ne}function it(e){ne=e}function Ce(e){mo(e)}const So="player.js",Eo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:So,getAngle:rt,getCameraHeight:nt,getPosition:be,hideMesh:Ce,loadAssets:bo,setAngle:it,setNewMaze:ot,setup:tt,update:Ae},Symbol.toStringTag,{value:"Module"}));let y;function Do(e,t,o=document.body){n.renderUpdate=Re,n.cameraYpos=c.defaultCameraY,n.scene=new Dt,n.camera=new kt(80,window.innerWidth/window.innerHeight),n.renderer=new At({antialias:!0}),n.renderer.shadowMap.enabled=c.enableShadows,n.renderer.shadowMap.type=Ct,o.appendChild(n.renderer.domElement),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(e,t),window.addEventListener("resize",Co),n.scene.background=new _e(c.bgColour),y=new zt(16777215,c.sunLightLevel),y.castShadow=!0,y.position.set(5,20,5),y.shadow.camera.left=-10,y.shadow.camera.right=10,y.shadow.camera.top=0,y.shadow.camera.bottom=-20,y.shadow.camera.near=10,y.shadow.camera.far=25,n.scene.add(y),n.fog=new Tt(c.bgColour,5,10),n.scene.fog=n.fog}function Re(e=!0){let t=!1;if(!n.orbitControlsEnabled){const o=be();if(n.firstPersonModeActive)n.camera.position.x=o.x,n.camera.position.z=o.z;else{const r=o.x-n.camera.position.x,i=o.z-n.camera.position.z;if(r!==0||i!==0){t=!0;const s=n.mazeExited?c.cameraExitEase:c.cameraEase;s>=1||Math.abs(r)<.008&&Math.abs(i)<.008?(n.camera.position.x=o.x,n.camera.position.z=o.z):(n.camera.position.x+=r*s,n.camera.position.z+=i*s)}}}(e||t)&&n.renderer.render(n.scene,n.camera)}function ko(){const e=.1*(c.playerLightLevel-n.playerLight.intensity),t=.1*(c.sunLightLevel-y.intensity);return n.playerLight.intensity+=e,y.intensity+=t,e<.01?(n.playerLight.intensity=c.playerLightLevel,n.exitLight.intensity=c.exitLightLevel,y.intensity=c.sunLightLevel,!0):!1}function Ao(){const e=.04*n.playerLight.intensity;return n.playerLight.intensity-=e,n.exitLight.intensity-=e,y.intensity-=e/2,e<.01?(n.playerLight.intensity=0,n.exitLight.intensity=0,y.intensity=0,!0):!1}function Co(){n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight),Re()}const V={},z={},R={},j={};let q=null,ye=!1,st=!1;function zo(e){const t=new _t(e);t.setResponseType("arraybuffer");for(const o in R)Object.hasOwn(R,o)&&t.load(c.soundsDir+R[o].filename,r=>{V[o]=r.transfer()})}function Fe(e){for(const t in e)if(Object.hasOwn(e,t)){const o=e[t];typeof o=="string"?R[t]={filename:o,volume:1}:typeof o=="object"&&o.filename&&(R[t]={filename:o.filename},R[t].volume=o.volume?o.volume:1)}}function He(e){for(const t in e)Object.hasOwn(e,t)&&(j[t]=e[t])}function at(){document.body.addEventListener("click",()=>{ye||ct()},{once:!0}),st=/firefox/i.test(navigator.userAgent),document.body.addEventListener("keydown",lt,{once:!0})}function lt(e){if(st&&e.key.length>1){ye||document.body.addEventListener("keydown",lt,{once:!0});return}ye||ct()}function ct(){q=new Rt,n.camera.add(q);const e=new AudioContext;for(const t in V)Object.hasOwn(V,t)&&(z[t]||(z[t]=new Ft(q),e.decodeAudioData(V[t],o=>{z[t].setBuffer(o),z[t].setLoop(!1),z[t].setVolume(R[t].volume),delete V[t]})));ye=!0}function re(e){return q===null?!0:z[e]?(z[e].isPlaying&&z[e].stop(),z[e].play(),!0):!1}function dt(e){if(q===null)return!0;if(j[e]){const t=j[e].length;if(t>0){const o=Math.floor(Math.random()*t),r=j[e][o];return re(r)?!0:(j[e].splice(o,1),!1)}else return!1}return!1}const To="sounds.js",_o=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:To,addAssets:Fe,addGroups:He,loadAssets:zo,play:re,playFromGroup:dt,setup:at},Symbol.toStringTag,{value:"Module"})),ft=Math.PI/2,Ro=new _e(16711680),Fo=new _e(65280);let v,$e,E,B,K,Q,M,P=null,Ie,Oe,ce,Ge=!1,he=!1;function ut(){v=n.scene,$e=n.exitLight,Q=new pe(16766720,0),v.add(Q),B=new pe(16766720,0),v.add(B),Ie=new Ee(.5,.04),Oe=new Ee(.04,.5),n.physicsWorld.addContactCallback("ball","closed_door",()=>{re("locked")}),Ge=!0}function Ho(e){const t=new Ht(e);t.load(c.modelDir+c.keyModelFile,o=>{E=o.scene,E.traverse(r=>{r instanceof we&&(r.material.emissive={b:0,r:1,g:.7,isColor:!0},r.material.emissiveIntensity=.55)}),E.scale.set(.6,.6,.6)},void 0,()=>{E=n.errorMesh.clone()}),t.load(c.modelDir+c.baseModelFile,o=>{K=o.scene,K.scale.set(.35,.1,.35)},void 0,()=>{K=n.errorMesh.clone()}),t.load(c.modelDir+c.doorModelFile,o=>{M=o.scene,M.scale.set(.42,.4,.3)},void 0,()=>{M=n.errorMesh.clone()}),Fe(c.keySounds),He(c.keySoundGroups)}function pt(e){if(!Ge)return;P!==null&&(n.physicsWorld.destroyBody(P),P=null),v.remove(E),v.remove(K),v.remove(M),Q.intensity=0,B.intensity=0,he=!1;const t=e;if(ce=t,t.deadends.length===0){t.key=!1,t.keyIndex=!1;return}const o=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[o],t.keyIndex=o,t.data[t.key.x][t.key.z]="K";const{x:r,z:i}=t.exit;t.data[r][i]="L";let s=t.exit.x,l=t.exit.z,f;t.exit.dir==="L"||t.exit.dir==="R"?(M.rotation.set(0,ft,0),s+=t.exit.dir==="R"?.5:-.5,f=Oe):(M.rotation.set(0,0,0),l+=t.exit.dir==="D"?.5:-.5,f=Ie);const u={type:"static",position:{x:s,y:l},userData:"closed_door"};P=n.physicsWorld.createBody(u),P.createFixture({shape:f}),K.position.set(t.key.x,0,t.key.z),v.add(K),Q.position.set(t.key.x,.1,t.key.z),Q.intensity=.04,E.position.set(t.key.x,.38,t.key.z),v.add(E),B.position.set(t.key.x,.44,t.key.z),B.intensity=.1,he=!0,M.position.set(s,0,l),v.add(M),$e.color=Ro}function gt(){return!Ge||!he||n.idleMode?!1:(E.rotateY(.03),E.rotateZ(.03),!0)}function yt(){v.remove(E),B.intensity=0,he=!1,re("keyPickup");const{x:e,z:t}=ce.exit;ce.data[e][t]="H",P!==null&&(n.physicsWorld.destroyBody(P),P=null);const o=ce.exit.dir;let r=M.position.x,i=M.position.z,s,l=0;o==="L"||o==="R"?(r+=o==="R"?.5:-.5,i+=.5,s=Ie):(l=ft,r+=.5,i+=o==="D"?.5:-.5,s=Oe);const f={type:"static",position:{x:r,y:i},userData:"open_door"};P=n.physicsWorld.createBody(f),P.createFixture({shape:s}),M.position.set(r,0,i),M.rotation.set(0,l,0),$e.color=Fo}const $o="key.js",Io=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:$o,collect:yt,create:pt,loadAssets:Ho,setup:ut,update:gt},Symbol.toStringTag,{value:"Module"})),Be=Math.PI/2,me=[],xe=[],ae=[],h={x:0,z:0,type:""};let W,de,J,k,L,U;function ht(){W=n.scene,de=n.camera,J=new pe(65280,0),W.add(J),n.exitLight=J,U={size:{x:0,z:0}},n.physicsWorld.addContactCallback("ball","wall",e=>{const t=e.getManifold().localNormal,o=e.getFixtureB().getBody().getLinearVelocity(),r=Math.abs(o.x*t.x),i=Math.abs(o.y*t.y);(r>.9||i>.9)&&re("wallhit")})}function Oo(e){const t=new Ze(e);for(const o of c.wallTextureFiles)t.load(c.textureDir+"walls/"+o,r=>{r.colorSpace=Se,me.push(r)},void 0,()=>{me.push(n.errorTexture)});for(const o of c.floorTextureFiles)t.load(c.textureDir+"floors/"+o,r=>{r.colorSpace=Se,xe.push(r)},void 0,()=>{xe.push(n.errorTexture)});Fe(c.mazeSounds),He(c.mazeSoundGroups)}function mt(e){U=e,ae.length>0&&(ae.forEach(a=>n.physicsWorld.destroyBody(a)),ae.length=0);const t={type:"static",position:{x:0,y:0},userData:"wall"},o=new Ee(.5,.5);for(let a=0;a<e.size.x;a++)for(let d=0;d<e.size.z;d++)if(e.data[a][d]===!1){t.position={x:a,y:d};const p=n.physicsWorld.createBody(t);ae.push(p),p.createFixture({shape:o})}const r=e.size.x,i=e.size.z;k&&(W.remove(k),k.geometry.dispose(),k.material.dispose(),k=null),L&&(W.remove(L),L.geometry.dispose(),L.material.dispose(),L=null),k=Go(e),k.castShadow=!0,k.receiveShadow=!0,W.add(k);const s=Math.floor(Math.random()*xe.length),l=xe[s];l.wrapS=l.wrapT=$t,l.repeat.set(r+15,i+15);const f=new It(r+15,i+15),u=new qe({map:l});L=new we(f,u),L.rotateX(-Be),L.position.set((r-1)/2,0,(i-1)/2),L.receiveShadow=!0,W.add(L),n.firstPersonModeActive?de.rotation.set(0,e.start.angle,0):de.rotation.set(-Be,0,0),de.position.set(e.start.x,n.cameraYpos,e.start.z),J.position.set(e.exit.x,c.exitLightY,e.exit.z),J.intensity=0,n.mazeExited=!1}function Go(e){const t=new Ot(1,c.mazeHeight,1),o=Math.floor(Math.random()*me.length),r=me[o],i=new qe({map:r}),s=new Gt(t,i,e.size.x*e.size.z);s.count=0;const l=new je;for(let f=0;f<e.size.x;f++)for(let u=0;u<e.size.z;u++)e.data[f][u]===!1&&(l.setPosition(f,c.mazeHeight/2,u),s.setMatrixAt(s.count++,l));return s}function xt(e,t,o){const r=Math.floor(e+.5),i=Math.floor(o+.5),s=h.x,l=h.z;if(r===s&&i===l)return;const f=h.type;h.x=r,h.z=i,r>=0&&r<U.size.x&&i>=0&&i<U.size.z?h.type=U.data[h.x][h.z]:h.type="O",h.type!==f&&h.type==="K"&&(yt(),U.data[h.x][h.z]="D")}function wt(){return h}const Wo="maze.js",Uo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Wo,create:mt,getPlayerGridInfo:wt,loadAssets:Oo,setup:ht,updatePlayerPosition:xt},Symbol.toStringTag,{value:"Module"}));var N=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(d){d.preventDefault(),r(++e%t.children.length)},!1);function o(d){return t.appendChild(d.dom),d}function r(d){for(var p=0;p<t.children.length;p++)t.children[p].style.display=p===d?"block":"none";e=d}var i=(performance||Date).now(),s=i,l=0,f=o(new N.Panel("FPS","#0ff","#002")),u=o(new N.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=o(new N.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:o,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(u.update(d-i,200),d>=s+1e3&&(f.update(l*1e3/(d-s),100),s=d,l=0,a)){var p=performance.memory;a.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){i=this.end()},domElement:t,setMode:r}};N.Panel=function(e,t,o){var r=1/0,i=0,s=Math.round,l=s(window.devicePixelRatio||1),f=80*l,u=48*l,a=3*l,d=2*l,p=3*l,D=15*l,b=74*l,x=30*l,F=document.createElement("canvas");F.width=f,F.height=u,F.style.cssText="width:80px;height:48px";var g=F.getContext("2d");return g.font="bold "+9*l+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=o,g.fillRect(0,0,f,u),g.fillStyle=t,g.fillText(e,a,d),g.fillRect(p,D,b,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(p,D,b,x),{dom:F,update:function(ie,Lt){r=Math.min(r,ie),i=Math.max(i,ie),g.fillStyle=o,g.globalAlpha=1,g.fillRect(0,0,f,D),g.fillStyle=t,g.fillText(s(ie)+" "+e+" ("+s(r)+"-"+s(i)+")",a,d),g.drawImage(F,p+l,D,b-l,x,p,D,b-l,x),g.fillRect(p+b-l,D,l,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(p+b-l,D,l,s((1-ie/Lt)*x))}}};let Le=!1,S,ee,Ke,ze;function Yo(){ze=new N,document.body.appendChild(ze.dom),ke("orbit_controls",Ko),ke("house_lights",Xo),S=new Wt(n.camera,n.renderer.domElement),S.enableDamping=!0,S.enabled=!1,S.minPolarAngle=.02,S.maxPolarAngle=Math.PI-.05,ee=new Ut(13421772,1),ee.intensity=0,n.scene.add(ee)}function Bo(){return ze.update(),n.orbitControlsEnabled?(S.update(),!0):!1}function Ko(){if(n.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}n.orbitControlsEnabled=!n.orbitControlsEnabled;const e=be();n.orbitControlsEnabled?(console.log("Orbit controls enabled"),Ke=n.camera.position.y,S.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),n.camera.position.x=e.x,n.camera.position.y=Ke,n.camera.position.z=e.z,n.camera.rotation.set(3*Math.PI/2,0,0),n.renderUpdate()),S.enabled=n.orbitControlsEnabled}function Xo(){Le=!Le,Le?(ee.intensity=1,n.scene.fog=null,console.log("House lights up")):(ee.intensity=0,n.scene.fog=n.fog,console.log("House lights down")),n.renderUpdate()}function Vo(){S&&S.target.set(n.camera.position.x,c.ballRadius,n.camera.position.z)}const H=new Bt(0,0,0,"YZX"),ve=new Yt,jo="pointerLockElement"in document;let fe=0,ue=0;const Te=Math.PI/2;function Zo(){if(!jo){console.log("browser does not support pointer lock, no first person view available");return}ke("first_person",qo),addEventListener("pointerlockchange",()=>{if(n.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}n.firstPersonModeActive?(document.exitPointerLock(),n.camera.rotation.set(-Te,0,0),n.camera.position.y=n.cameraYpos=c.defaultCameraY,lo(Xe),Ce(!1),n.firstPersonModeActive=!1,console.log("first person view disabled")):(n.camera.rotation.set(0,-rt(),0),n.camera.position.y=n.cameraYpos=nt(),ao(Xe),Ce(!0),n.firstPersonModeActive=!0,console.log("first person view enabled")),n.renderUpdate()})}function qo(){n.firstPersonModeActive?document.exitPointerLock():n.renderer.domElement.requestPointerLock()}function Xe(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;fe=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*c.mouseSensitivity,ue=t*c.mouseSensitivity}function Qo(){if(!n.firstPersonModeActive)return!1;let e=!1;return(fe!==0||ue!==0)&&(H.setFromQuaternion(n.camera.quaternion),H.x-=fe,H.y-=ue,H.x=Math.max(-Te,Math.min(Te,H.x)),n.camera.quaternion.setFromEuler(H),n.camera.getWorldDirection(ve),it(Math.atan2(ve.x,-ve.z)),fe=0,ue=0,e=!0),e}Math.random=c.randomSeed?De(c.randomSeed):De();n.errorTexture=Nt();n.errorMesh=eo();const m=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Pe=1,A=m.init,Mt=0;document.addEventListener("DOMContentLoaded",()=>{Mt=Jt(),ge("Loading..."),to([Eo,Uo,Io,_o],Jo)});function Jo(){co(),Do(window.innerWidth,window.innerHeight-Mt),ht(),tt(xt),ut(),so(),Yo(),Zo(),at(),requestAnimationFrame(bt)}function bt(){let e=!0;switch(A){case m.init:{ge("Level:",Pe);const t=Math.random().toString().substring(2),o=5+Pe*2,r=ro(o,o,t);mt(r),pt(r),ot(r),Vo(),A=m.fadeIn}break;case m.fadeIn:ko()&&(A=m.play);break;case m.play:e=Ae(),e|=Qo(),e|=gt(),wt().type==="O"&&(Pe++,n.mazeExited=!0,A=m.fadeOut,dt("mazeExit"));break;case m.fadeOut:Ae(),Ao()&&(A=m.pause);break;case m.pause:setTimeout(()=>{A=m.init},800),A=m.idle;break;case m.idle:break;default:console.log("game_loop(): Unknown game state: "+A),A=m.pause;break}e|=Bo(),uo(),Re(e),requestAnimationFrame(bt)}
