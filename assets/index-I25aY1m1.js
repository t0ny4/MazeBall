import{N as K,G as wt}from"./keystrokes-zXtNIVHG.js";import{W as Mt,V as ee,C as bt,B as Le}from"./planck-D8CQOpC-.js";import{M as Be,T as Ke,S as ve,a as Xe,b as Lt,c as he,P as ue,d as vt,e as Pt,W as St,f as Dt,C as ze,D as kt,F as Et,g as At,A as zt,h as Ct,G as Tt,R as _t,i as Rt,j as Ve,B as Ft,I as Gt,O as It,k as Ot,V as Ht,E as $t,L as Wt,l as Ut,m as Yt}from"./three-DGGowSNC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();function Pe(...e){let t,o,i,r;if(e.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),e=[a[0],a[1],a[2]]}s(e);function s(a){const d=l();t=d(" "),o=d(" "),i=d(" "),r=1;for(let p=0;p<a.length;p++)t-=d(a[p]),t<0&&(t+=1),o-=d(a[p]),o<0&&(o+=1),i-=d(a[p]),i<0&&(i+=1)}function l(){let a=4022871197;function d(p){p=p.toString();const k=p.length;for(let b=0;b<k;b++){a+=p.charCodeAt(b);let x=.02519603282416938*a;a=x>>>0,x-=a,x*=a,a=x>>>0,x-=a,a+=x*4294967296}return(a>>>0)*23283064365386963e-26}return d}function f(a){return parseInt(a,10)===a}function u(){const a=2091639*t+r*23283064365386963e-26;return t=o,o=i,i=a-(r=a|0),i}return u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.int32=function(){return u()*4294967296},u.cycle=function(a){a=typeof a>"u"?1:Number(a),a<1&&(a=1);for(let d=0;d<a;d++)u()},u.range=function(a=0,d=0){if(a===0&&d===0)return 0;if(a>d){const p=a;a=d,d=p}return f(a)&&f(d)?Math.floor(u()*(d-a+1))+a:u()*(d-a)+a},u.restart=function(){s(e)},u.seed=function(...a){s(a)},u}const Bt={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null},Kt={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},n=new Proxy(Object.seal(Bt),Kt),Xt={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,soundsDir:"./sounds/",modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",keySounds:{keyPickup:{filename:"DM-CGS-07.ogg",volume:.4}},keySoundGroups:{},ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],mazeSounds:{locked:{filename:"DM-CGS-10.ogg",volume:.3},dm12:{filename:"DM-CGS-12.ogg",volume:.25},dm26:{filename:"DM-CGS-26.ogg",volume:.4},wallhit:{filename:"DM-CGS-03.ogg",volume:.05}},mazeSoundGroups:{mazeExit:["dm12","dm26"]},controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Vt={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},c=new Proxy(Object.freeze(Xt),Vt),jt=Math.PI/2,G=Pe();function Zt(e,t,o){const i=e<3?3:e|1,r=t<3?3:t|1,s={x:i,z:r},l=o===void 0?Math.random().toString().substring(2):o;G.seed(l);const f={size:s,data:Array.from({length:s.x},()=>Array(s.z).fill(!1)),deadends:[],seed:l},u=Qt(s);return f.start=u.start,f.start.angle=0,f.end=u.end,f.exit=u.exit,f.data[f.exit.x][f.exit.z]="H",f}function qt(e,t,o){const i=Zt(e,t,o);je(i,i.start.x,i.start.z);const{x:r,z:s}=i.start;let l=0;return i.data[r-1][s]!==!1?l=1:i.data[r][s+1]!==!1?l=2:i.data[r+1][s]!==!1&&(l=3),i.data[i.start.x][i.start.z]="S",i.data[i.end.x][i.end.z]="E",i.start.angle=l*jt,i}function je(e,t,o){let i=t===e.end.x&&o===e.end.z;for(;;){const r=[];let s;if(o<e.size.z-3&&e.data[t][o+2]===!1&&r.push([0,1]),t<e.size.x-3&&e.data[t+2][o]===!1&&r.push([1,0]),o>2&&e.data[t][o-2]===!1&&r.push([0,-1]),t>2&&e.data[t-2][o]===!1&&r.push([-1,0]),r.length===0)return i?e.data[t][o]="*":e.data[t][o]===!1&&(e.data[t][o]="D",e.deadends.push({x:t,z:o})),i;if(e.data[t][o]="",r.length===1?[s]=r:s=r[Math.floor(G()*r.length)],je(e,t+s[0]*2,o+s[1]*2)?(e.data[t+s[0]][o+s[1]]="*",i=!0):e.data[t+s[0]][o+s[1]]="",r.length===1)return i&&(e.data[t][o]="*"),i}}function Qt(e){const t={},o={};let i=G()>.5,r=G()>.5;t.x=r?1:e.x-2,t.z=i?1:e.z-2;const s=G();s>.5?(i=!i,r=!r):s>.25?i=!i:r=!r,o.x=r?1:e.x-2;const l=r?-1:1;o.z=i?1:e.z-2;const f=i?-1:1,u={...o};return G()>.5?(o.z+=f,o.dir=i?"U":"D"):(o.x+=l,o.dir=r?"L":"R"),{start:t,end:u,exit:o}}let I=0,O=0;function Jt(){function e(){O+=1}function t(){O-=1}function o(){I-=1}function i(){I+=1}K(c.controlKeys.up,{onPressed:t,onReleased:e}),K(c.controlKeys.down,{onPressed:e,onReleased:t}),K(c.controlKeys.left,{onPressed:o,onReleased:i}),K(c.controlKeys.right,{onPressed:i,onReleased:o})}function Nt(e){addEventListener("pointermove",e,!1)}function eo(e){removeEventListener("pointermove",e)}function Se(e,t){if(!c.keys[e]){console.error("Unknown key index: "+e);return}const o=c.keys[e];o.includes(">")?wt(o,t):K(o,t)}let j;const z={};function to(){j=new Mt({gravity:new ee(0,0)}),n.physicsWorld=j,n.physicsWorld.addContactCallback=oo,j.on("begin-contact",e=>{const t=e.m_nodeA.other.m_userData,o=e.m_nodeB.other.m_userData;if(t===void 0||o===void 0||!z[t]||!z[t][o])return;const i=z[t][o],r=performance.now();r-i.last<250||(i.last=r,i.callback(e))})}function oo(e,t,o){z[e]||(z[e]={}),z[e][t]||(z[e][t]={}),z[e][t].callback=o,z[e][t].last=0}function no(){j.step(1/60),j.clearForces()}const Oe=new ee(0,0),re=new Be,T=c.ballRadius,He=c.minVelocity;let w,U,ae,Ze=()=>{console.warn("gUpdateMazePosition not set")};function io(e){new Ke(e).load(c.textureDir+"ball/"+c.ballTextureFile,o=>{ae=o,ae.colorSpace=ve},void 0,()=>{ae=n.errorTexture})}function ro(e){typeof e=="function"&&(Ze=e),U=n.physicsWorld.createBody({type:"dynamic",position:Oe,awake:!1,fixedRotation:!0,userData:"ball"}),U.createFixture({shape:new bt(Oe,T),restitution:.15,density:.2});const t=new Xe(T),o=new Lt({map:ae});return w=new he(t,o),w.position.y=T,w.castShadow=!0,n.scene.add(w),[U,w]}function so(){if(U.isAwake()){const r=U.getLinearVelocity();r.mul(.98),Math.abs(r.x)<He&&Math.abs(r.y)<He&&(r.x=0,r.y=0)}const e=U.getPosition(),t=e.y,o=e.x-w.position.x,i=t-w.position.z;return o!==0||i!==0?(w.position.set(e.x,T,t),Ze(e.x,T,t),n.firstPersonModeActive||(re.makeRotationZ(-o/T),w.matrix.premultiply(re),re.makeRotationX(i/T),w.matrix.premultiply(re),w.rotation.setFromRotationMatrix(w.matrix)),!0):!1}function ao(){return T}function lo(e){w.visible=!e}let te,xe,H,oe=0,qe=()=>{console.warn("gUpdateMazePosition not set")};const co=new ee(0,0),Qe=Math.PI/4,fo=Math.sin(Qe),uo=Math.cos(Qe);function po(e){io(e)}function Je(e){typeof e=="function"&&(qe=e),[xe,te]=ro(e),H=new ue(16769248,c.playerLightLevel),H.castShadow=!1,n.scene.add(H),n.playerLight=H}function De(){if(I!==0||O!==0){let t;if(I!==0&&O!==0?t=new ee(I*uo,O*fo):t=new ee(I,O),t.mul(c.keyForce),n.firstPersonModeActive){const o=Math.cos(oe),i=Math.sin(oe),r=o*t.x-i*t.y,s=i*t.x+o*t.y;t.x=r,t.y=s}yo(t)}n.playerLight.position.x=te.position.x,n.playerLight.position.z=te.position.z;const e=so();return e&&(n.idleStartMs=0,n.idleMode=!1),!e&&!n.idleMode&&(n.idleStartMs===0?n.idleStartMs=Date.now():Date.now()-n.idleStartMs>c.idleTimeout*1e3&&(n.idleMode=!0)),e}function go(e){xe.setLinearVelocity(e)}function Ne(e){go(co),mo(e.start.x,e.start.z),oe=-e.start.angle,H.position.set(e.start.x,c.lightYpos,e.start.z),H.intensity=0}function mo(e,t){const o=we();te.position.set(e,o.y,t),xe.setPosition({x:e,y:t}),qe(e,o.y,t)}function we(){return te.position}function et(){return ao()}function yo(e){xe.applyForceToCenter(e)}function tt(){return oe}function ot(e){oe=e}function ke(e){lo(e)}const ho="player.js",xo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:ho,getAngle:tt,getCameraHeight:et,getPosition:we,hideMesh:ke,loadAssets:po,setAngle:ot,setNewMaze:Ne,setup:Je,update:De},Symbol.toStringTag,{value:"Module"}));let m;function wo(e=document.body){n.renderUpdate=Ce,n.cameraYpos=c.defaultCameraY,n.scene=new vt,n.camera=new Pt(80,window.innerWidth/window.innerHeight),n.renderer=new St({antialias:!0}),n.renderer.shadowMap.enabled=c.enableShadows,n.renderer.shadowMap.type=Dt,e.appendChild(n.renderer.domElement),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",Lo),n.scene.background=new ze(c.bgColour),m=new kt(16777215,c.sunLightLevel),m.castShadow=!0,m.position.set(5,20,5),m.shadow.camera.left=-10,m.shadow.camera.right=10,m.shadow.camera.top=0,m.shadow.camera.bottom=-20,m.shadow.camera.near=10,m.shadow.camera.far=25,n.scene.add(m),n.fog=new Et(c.bgColour,5,10),n.scene.fog=n.fog}function Ce(e=!0){let t=!1;if(!n.orbitControlsEnabled){const o=we();if(n.firstPersonModeActive)n.camera.position.x=o.x,n.camera.position.z=o.z;else{const i=o.x-n.camera.position.x,r=o.z-n.camera.position.z;if(i!==0||r!==0){t=!0;const s=n.mazeExited?c.cameraExitEase:c.cameraEase;s>=1||Math.abs(i)<.008&&Math.abs(r)<.008?(n.camera.position.x=o.x,n.camera.position.z=o.z):(n.camera.position.x+=i*s,n.camera.position.z+=r*s)}}}(e||t)&&n.renderer.render(n.scene,n.camera)}function Mo(){const e=.1*(c.playerLightLevel-n.playerLight.intensity),t=.1*(c.sunLightLevel-m.intensity);return n.playerLight.intensity+=e,m.intensity+=t,e<.01?(n.playerLight.intensity=c.playerLightLevel,n.exitLight.intensity=c.exitLightLevel,m.intensity=c.sunLightLevel,!0):!1}function bo(){const e=.04*n.playerLight.intensity;return n.playerLight.intensity-=e,n.exitLight.intensity-=e,m.intensity-=e/2,e<.01?(n.playerLight.intensity=0,n.exitLight.intensity=0,m.intensity=0,!0):!1}function Lo(){n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight),Ce()}const X={},C={},_={},V={};let Z=null,pe=!1,nt=!1;function vo(e){const t=new At(e);t.setResponseType("arraybuffer");for(const o in _)Object.hasOwn(_,o)&&t.load(c.soundsDir+_[o].filename,i=>{X[o]=i.transfer()})}function Te(e){for(const t in e)if(Object.hasOwn(e,t)){const o=e[t];typeof o=="string"?_[t]={filename:o,volume:1}:typeof o=="object"&&o.filename&&(_[t]={filename:o.filename},_[t].volume=o.volume?o.volume:1)}}function _e(e){for(const t in e)Object.hasOwn(e,t)&&(V[t]=e[t])}function it(){document.body.addEventListener("click",()=>{pe||st()},{once:!0}),nt=/firefox/i.test(navigator.userAgent),document.body.addEventListener("keydown",rt,{once:!0})}function rt(e){if(nt&&e.key.length>1){pe||document.body.addEventListener("keydown",rt,{once:!0});return}pe||st()}function st(){Z=new zt,n.camera.add(Z);const e=new AudioContext;for(const t in X)Object.hasOwn(X,t)&&(C[t]||(C[t]=new Ct(Z),e.decodeAudioData(X[t],o=>{C[t].setBuffer(o),C[t].setLoop(!1),C[t].setVolume(_[t].volume),delete X[t]})));pe=!0}function ne(e){return Z===null?!0:C[e]?(C[e].isPlaying&&C[e].stop(),C[e].play(),!0):!1}function at(e){if(Z===null)return!0;if(V[e]){const t=V[e].length;if(t>0){const o=Math.floor(Math.random()*t),i=V[e][o];return ne(i)?!0:(V[e].splice(o,1),!1)}else return!1}return!1}const Po="sounds.js",So=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Po,addAssets:Te,addGroups:_e,loadAssets:vo,play:ne,playFromGroup:at,setup:it},Symbol.toStringTag,{value:"Module"})),lt=Math.PI/2,Do=new ze(16711680),ko=new ze(65280);let v,Re,D,Y,B,q,M,P=null,Fe,Ge,le,Ie=!1,ge=!1;function ct(){v=n.scene,Re=n.exitLight,q=new ue(16766720,0),v.add(q),Y=new ue(16766720,0),v.add(Y),Fe=new Le(.5,.04),Ge=new Le(.04,.5),n.physicsWorld.addContactCallback("ball","closed_door",()=>{ne("locked")}),Ie=!0}function Eo(e){const t=new Tt(e);t.load(c.modelDir+c.keyModelFile,o=>{D=o.scene,D.traverse(i=>{i instanceof he&&(i.material.emissive={b:0,r:1,g:.7,isColor:!0},i.material.emissiveIntensity=.55)}),D.scale.set(.6,.6,.6)},void 0,()=>{D=n.errorMesh.clone()}),t.load(c.modelDir+c.baseModelFile,o=>{B=o.scene,B.scale.set(.35,.1,.35)},void 0,()=>{B=n.errorMesh.clone()}),t.load(c.modelDir+c.doorModelFile,o=>{M=o.scene,M.scale.set(.42,.4,.3)},void 0,()=>{M=n.errorMesh.clone()}),Te(c.keySounds),_e(c.keySoundGroups)}function dt(e){if(!Ie)return;P!==null&&(n.physicsWorld.destroyBody(P),P=null),v.remove(D),v.remove(B),v.remove(M),q.intensity=0,Y.intensity=0,ge=!1;const t=e;if(le=t,t.deadends.length===0){t.key=!1,t.keyIndex=!1;return}const o=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[o],t.keyIndex=o,t.data[t.key.x][t.key.z]="K";const{x:i,z:r}=t.exit;t.data[i][r]="L";let s=t.exit.x,l=t.exit.z,f;t.exit.dir==="L"||t.exit.dir==="R"?(M.rotation.set(0,lt,0),s+=t.exit.dir==="R"?.5:-.5,f=Ge):(M.rotation.set(0,0,0),l+=t.exit.dir==="D"?.5:-.5,f=Fe);const u={type:"static",position:{x:s,y:l},userData:"closed_door"};P=n.physicsWorld.createBody(u),P.createFixture({shape:f}),B.position.set(t.key.x,0,t.key.z),v.add(B),q.position.set(t.key.x,.1,t.key.z),q.intensity=.04,D.position.set(t.key.x,.38,t.key.z),v.add(D),Y.position.set(t.key.x,.44,t.key.z),Y.intensity=.1,ge=!0,M.position.set(s,0,l),v.add(M),Re.color=Do}function ft(){return!Ie||!ge||n.idleMode?!1:(D.rotateY(.03),D.rotateZ(.03),!0)}function ut(){v.remove(D),Y.intensity=0,ge=!1,ne("keyPickup");const{x:e,z:t}=le.exit;le.data[e][t]="H",P!==null&&(n.physicsWorld.destroyBody(P),P=null);const o=le.exit.dir;let i=M.position.x,r=M.position.z,s,l=0;o==="L"||o==="R"?(i+=o==="R"?.5:-.5,r+=.5,s=Fe):(l=lt,i+=.5,r+=o==="D"?.5:-.5,s=Ge);const f={type:"static",position:{x:i,y:r},userData:"open_door"};P=n.physicsWorld.createBody(f),P.createFixture({shape:s}),M.position.set(i,0,r),M.rotation.set(0,l,0),Re.color=ko}const Ao="key.js",zo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Ao,collect:ut,create:dt,loadAssets:Eo,setup:ct,update:ft},Symbol.toStringTag,{value:"Module"})),$e=Math.PI/2,me=[],ye=[],se=[],y={x:0,z:0,type:""};let $,ce,Q,E,L,W;function pt(){$=n.scene,ce=n.camera,Q=new ue(65280,0),$.add(Q),n.exitLight=Q,W={size:{x:0,z:0}},n.physicsWorld.addContactCallback("ball","wall",e=>{const t=e.getManifold().localNormal,o=e.getFixtureB().getBody().getLinearVelocity(),i=Math.abs(o.x*t.x),r=Math.abs(o.y*t.y);(i>.9||r>.9)&&ne("wallhit")})}function Co(e){const t=new Ke(e);for(const o of c.wallTextureFiles)t.load(c.textureDir+"walls/"+o,i=>{i.colorSpace=ve,me.push(i)},void 0,()=>{me.push(n.errorTexture)});for(const o of c.floorTextureFiles)t.load(c.textureDir+"floors/"+o,i=>{i.colorSpace=ve,ye.push(i)},void 0,()=>{ye.push(n.errorTexture)});Te(c.mazeSounds),_e(c.mazeSoundGroups)}function gt(e){W=e,se.length>0&&(se.forEach(a=>n.physicsWorld.destroyBody(a)),se.length=0);const t={type:"static",position:{x:0,y:0},userData:"wall"},o=new Le(.5,.5);for(let a=0;a<e.size.x;a++)for(let d=0;d<e.size.z;d++)if(e.data[a][d]===!1){t.position={x:a,y:d};const p=n.physicsWorld.createBody(t);se.push(p),p.createFixture({shape:o})}const i=e.size.x,r=e.size.z;E&&($.remove(E),E.geometry.dispose(),E.material.dispose(),E=null),L&&($.remove(L),L.geometry.dispose(),L.material.dispose(),L=null),E=To(e),E.castShadow=!0,E.receiveShadow=!0,$.add(E);const s=Math.floor(Math.random()*ye.length),l=ye[s];l.wrapS=l.wrapT=_t,l.repeat.set(i+15,r+15);const f=new Rt(i+15,r+15),u=new Ve({map:l});L=new he(f,u),L.rotateX(-$e),L.position.set((i-1)/2,0,(r-1)/2),L.receiveShadow=!0,$.add(L),n.firstPersonModeActive?ce.rotation.set(0,e.start.angle,0):ce.rotation.set(-$e,0,0),ce.position.set(e.start.x,n.cameraYpos,e.start.z),Q.position.set(e.exit.x,c.exitLightY,e.exit.z),Q.intensity=0,n.mazeExited=!1}function To(e){const t=new Ft(1,c.mazeHeight,1),o=Math.floor(Math.random()*me.length),i=me[o],r=new Ve({map:i}),s=new Gt(t,r,e.size.x*e.size.z);s.count=0;const l=new Be;for(let f=0;f<e.size.x;f++)for(let u=0;u<e.size.z;u++)e.data[f][u]===!1&&(l.setPosition(f,c.mazeHeight/2,u),s.setMatrixAt(s.count++,l));return s}function mt(e,t,o){const i=Math.floor(e+.5),r=Math.floor(o+.5),s=y.x,l=y.z;if(i===s&&r===l)return;const f=y.type;y.x=i,y.z=r,i>=0&&i<W.size.x&&r>=0&&r<W.size.z?y.type=W.data[y.x][y.z]:y.type="O",y.type!==f&&y.type==="K"&&(ut(),W.data[y.x][y.z]="D")}function yt(){return y}const _o="maze.js",Ro=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:_o,create:gt,getPlayerGridInfo:yt,loadAssets:Co,setup:pt,updatePlayerPosition:mt},Symbol.toStringTag,{value:"Module"}));var J=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(d){d.preventDefault(),i(++e%t.children.length)},!1);function o(d){return t.appendChild(d.dom),d}function i(d){for(var p=0;p<t.children.length;p++)t.children[p].style.display=p===d?"block":"none";e=d}var r=(performance||Date).now(),s=r,l=0,f=o(new J.Panel("FPS","#0ff","#002")),u=o(new J.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=o(new J.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:o,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(u.update(d-r,200),d>=s+1e3&&(f.update(l*1e3/(d-s),100),s=d,l=0,a)){var p=performance.memory;a.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){r=this.end()},domElement:t,setMode:i}};J.Panel=function(e,t,o){var i=1/0,r=0,s=Math.round,l=s(window.devicePixelRatio||1),f=80*l,u=48*l,a=3*l,d=2*l,p=3*l,k=15*l,b=74*l,x=30*l,R=document.createElement("canvas");R.width=f,R.height=u,R.style.cssText="width:80px;height:48px";var g=R.getContext("2d");return g.font="bold "+9*l+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=o,g.fillRect(0,0,f,u),g.fillStyle=t,g.fillText(e,a,d),g.fillRect(p,k,b,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(p,k,b,x),{dom:R,update:function(ie,xt){i=Math.min(i,ie),r=Math.max(r,ie),g.fillStyle=o,g.globalAlpha=1,g.fillRect(0,0,f,k),g.fillStyle=t,g.fillText(s(ie)+" "+e+" ("+s(i)+"-"+s(r)+")",a,d),g.drawImage(R,p+l,k,b-l,x,p,k,b-l,x),g.fillRect(p+b-l,k,l,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(p+b-l,k,l,s((1-ie/xt)*x))}}};let Me=!1,S,N,We,Ee;function Fo(){Ee=new J,document.body.appendChild(Ee.dom),Se("orbit_controls",Io),Se("house_lights",Oo),S=new It(n.camera,n.renderer.domElement),S.enableDamping=!0,S.enabled=!1,S.minPolarAngle=.02,S.maxPolarAngle=Math.PI-.05,N=new Ot(13421772,1),N.intensity=0,n.scene.add(N)}function Go(){return Ee.update(),n.orbitControlsEnabled?(S.update(),!0):!1}function Io(){if(n.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}n.orbitControlsEnabled=!n.orbitControlsEnabled;const e=we();n.orbitControlsEnabled?(console.log("Orbit controls enabled"),We=n.camera.position.y,S.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),n.camera.position.x=e.x,n.camera.position.y=We,n.camera.position.z=e.z,n.camera.rotation.set(3*Math.PI/2,0,0),n.renderUpdate()),S.enabled=n.orbitControlsEnabled}function Oo(){Me=!Me,Me?(N.intensity=1,n.scene.fog=null,console.log("House lights up")):(N.intensity=0,n.scene.fog=n.fog,console.log("House lights down")),n.renderUpdate()}function Ho(){S&&S.target.set(n.camera.position.x,c.ballRadius,n.camera.position.z)}const F=new $t(0,0,0,"YZX"),be=new Ht,$o="pointerLockElement"in document;let de=0,fe=0;const Ae=Math.PI/2;function Wo(){if(!$o){console.log("browser does not support pointer lock, no first person view available");return}Se("first_person",Uo),addEventListener("pointerlockchange",()=>{if(n.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}n.firstPersonModeActive?(document.exitPointerLock(),n.camera.rotation.set(-Ae,0,0),n.camera.position.y=n.cameraYpos=c.defaultCameraY,eo(Ue),ke(!1),n.firstPersonModeActive=!1,console.log("first person view disabled")):(n.camera.rotation.set(0,-tt(),0),n.camera.position.y=n.cameraYpos=et(),Nt(Ue),ke(!0),n.firstPersonModeActive=!0,console.log("first person view enabled")),n.renderUpdate()})}function Uo(){n.firstPersonModeActive?document.exitPointerLock():n.renderer.domElement.requestPointerLock()}function Ue(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;de=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*c.mouseSensitivity,fe=t*c.mouseSensitivity}function Yo(){if(!n.firstPersonModeActive)return!1;let e=!1;return(de!==0||fe!==0)&&(F.setFromQuaternion(n.camera.quaternion),F.x-=de,F.y-=fe,F.x=Math.max(-Ae,Math.min(Ae,F.x)),n.camera.quaternion.setFromEuler(F),n.camera.getWorldDirection(be),ot(Math.atan2(be.x,-be.z)),de=0,fe=0,e=!0),e}Math.random=c.randomSeed?Pe(c.randomSeed):Pe();n.errorTexture=Xo();n.errorMesh=Vo();const h=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Ye=1,A=h.init;document.addEventListener("DOMContentLoaded",()=>{Bo([xo,Ro,zo,So],Ko)});function Bo(e,t){let o=!1,i=!1;const r=new Wt;r.onError=s=>{console.warn("Failed to load asset:",s),i=!0},r.onLoad=()=>{o&&(i&&console.error("LoadingManager: finished loading asset files with errors"),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(r):console.warn(s,"has no loadAssets method")}),o=!0}function Ko(){to(),wo(),pt(),Je(mt),ct(),Jt(),Fo(),Wo(),it(),requestAnimationFrame(ht)}function ht(){let e=!0;switch(A){case h.init:{const t=Math.random().toString().substring(2),o=5+Ye*2,i=qt(o,o,t);gt(i),dt(i),Ne(i),Ho(),A=h.fadeIn}break;case h.fadeIn:Mo()&&(A=h.play);break;case h.play:e=De(),e|=Yo(),e|=ft(),yt().type==="O"&&(Ye++,n.mazeExited=!0,A=h.fadeOut,at("mazeExit"));break;case h.fadeOut:De(),bo()&&(A=h.pause);break;case h.pause:setTimeout(()=>{A=h.init},800),A=h.idle;break;case h.idle:break;default:console.log("game_loop(): Unknown game state: "+A),A=h.pause;break}e|=Go(),no(),Ce(e),requestAnimationFrame(ht)}function Xo(){const o=new Uint8Array(1024);for(let r=0;r<1024;r+=4)o[r]=255,o[r+1]=105,o[r+2]=180,o[r+3]=255;const i=new Ut(o,16,16);return i.needsUpdate=!0,i}function Vo(){const e=new Xe(.1),t=new Yt({color:16738740});return new he(e,t)}
