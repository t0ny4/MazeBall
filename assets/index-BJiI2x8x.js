import{N as j,G as pt}from"./keystrokes-zXtNIVHG.js";import{W as gt,V as N,C as ht,B as we}from"./planck-D8CQOpC-.js";import{M as Ue,T as We,S as Me,a as Ye,b as yt,c as pe,P as le,d as mt,e as xt,W as wt,f as Mt,C as Ee,D as bt,F as Lt,g as Pt,A as vt,h as St,G as Et,R as At,i as Dt,j as je,B as kt,I as Tt,O as Ct,k as zt,V as Rt,E as _t,L as Ot,l as Ft,m as Gt}from"./three-C2Rx8NKe.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();function _e(...e){let t,o,r,i;if(e.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),e=[a[0],a[1],a[2]]}s(e);function s(a){const d=c();t=d(" "),o=d(" "),r=d(" "),i=1;for(let f=0;f<a.length;f++)t-=d(a[f]),t<0&&(t+=1),o-=d(a[f]),o<0&&(o+=1),r-=d(a[f]),r<0&&(r+=1)}function c(){let a=4022871197;function d(f){f=f.toString();const A=f.length;for(let b=0;b<A;b++){a+=f.charCodeAt(b);let x=.02519603282416938*a;a=x>>>0,x-=a,x*=a,a=x>>>0,x-=a,a+=x*4294967296}return(a>>>0)*23283064365386963e-26}return d}function p(a){return parseInt(a,10)===a}function u(){const a=2091639*t+i*23283064365386963e-26;return t=o,o=r,r=a-(i=a|0),r}return u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.int32=function(){return u()*4294967296},u.cycle=function(a){a=typeof a>"u"?1:Number(a),a<1&&(a=1);for(let d=0;d<a;d++)u()},u.range=function(a=0,d=0){if(a===0&&d===0)return 0;if(a>d){const f=a;a=d,d=f}return p(a)&&p(d)?Math.floor(u()*(d-a+1))+a:u()*(d-a)+a},u.restart=function(){s(e)},u.seed=function(...a){s(a)},u}const Ht={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null},$t={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},n=new Proxy(Object.seal(Ht),$t),It={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,soundsDir:"./sounds/",modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",keySounds:{keyPickup:"DM-CGS-03.ogg"},keySoundGroups:{},ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],mazeSounds:{locked:"DM-CGS-10.ogg",dm12:"DM-CGS-12.ogg",dm26:"DM-CGS-26.ogg"},mazeSoundGroups:{mazeExit:["dm12","dm26"]},controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Ut={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},l=new Proxy(Object.freeze(It),Ut),Wt=Math.PI/2;function Yt(e){const t=5+e*2,o=t,r={size:{x:t,z:o},data:Array.from({length:t},()=>Array(o).fill(!1)),deadends:[]},i=Xt(r.size);return r.start=i.start,r.start.angle=0,r.end=i.end,r.exit=i.exit,r.data[r.exit.x][r.exit.z]="H",r}function jt(e){const t=Yt(e);Xe(t,t.start.x,t.start.z);const{x:o,z:r}=t.start;let i=0;return t.data[o-1][r]!==!1?i=1:t.data[o][r+1]!==!1?i=2:t.data[o+1][r]!==!1&&(i=3),t.data[t.start.x][t.start.z]="S",t.data[t.end.x][t.end.z]="E",t.start.angle=i*Wt,t}function Xe(e,t,o){let r=t===e.end.x&&o===e.end.z;for(;;){const i=[];let s;if(o<e.size.z-3&&e.data[t][o+2]===!1&&i.push([0,1]),t<e.size.x-3&&e.data[t+2][o]===!1&&i.push([1,0]),o>2&&e.data[t][o-2]===!1&&i.push([0,-1]),t>2&&e.data[t-2][o]===!1&&i.push([-1,0]),i.length===0)return r?e.data[t][o]="*":e.data[t][o]===!1&&(e.data[t][o]="D",e.deadends.push({x:t,z:o})),r;if(e.data[t][o]="",i.length===1?[s]=i:s=i[Math.floor(Math.random()*i.length)],Xe(e,t+s[0]*2,o+s[1]*2)?(e.data[t+s[0]][o+s[1]]="*",r=!0):e.data[t+s[0]][o+s[1]]="",i.length===1)return r&&(e.data[t][o]="*"),r}}function Xt(e){const t={},o={};let r=Math.random()>.5,i=Math.random()>.5;t.x=i?1:e.x-2,t.z=r?1:e.z-2;const s=Math.random();s>.5?(r=!r,i=!i):s>.25?r=!r:i=!i,o.x=i?1:e.x-2;const c=i?-1:1;o.z=r?1:e.z-2;const p=r?-1:1,u={...o};return Math.random()>.5?(o.z+=p,o.dir=r?"U":"D"):(o.x+=c,o.dir=i?"L":"R"),{start:t,end:u,exit:o}}let _=0,O=0;function Kt(){function e(){O+=1}function t(){O-=1}function o(){_-=1}function r(){_+=1}j(l.controlKeys.up,{onPressed:t,onReleased:e}),j(l.controlKeys.down,{onPressed:e,onReleased:t}),j(l.controlKeys.left,{onPressed:o,onReleased:r}),j(l.controlKeys.right,{onPressed:r,onReleased:o})}function Vt(e){addEventListener("pointermove",e,!1)}function Zt(e){removeEventListener("pointermove",e)}function be(e,t){if(!l.keys[e]){console.error("Unknown key index: "+e);return}const o=l.keys[e];o.includes(">")?pt(o,t):j(o,t)}let ce;function Bt(){ce=new gt({gravity:new N(0,0)}),n.physicsWorld=ce}function qt(){ce.step(1/60),ce.clearForces()}const Oe=new N(0,0),te=new Ue,T=l.ballRadius,Fe=l.minVelocity;let w,I,ne,Ke=()=>{console.warn("gUpdateMazePosition not set")};function Nt(e){new We(e).load(l.textureDir+"ball/"+l.ballTextureFile,o=>{ne=o,ne.colorSpace=Me},void 0,()=>{ne=n.errorTexture})}function Qt(e){typeof e=="function"&&(Ke=e),I=n.physicsWorld.createBody({type:"dynamic",position:Oe,awake:!1,fixedRotation:!0}),I.createFixture({shape:new ht(Oe,T),restitution:.15,density:.2});const t=new Ye(T),o=new yt({map:ne});return w=new pe(t,o),w.position.y=T,w.castShadow=!0,n.scene.add(w),[I,w]}function Jt(){if(I.isAwake()){const i=I.getLinearVelocity();i.mul(.98),Math.abs(i.x)<Fe&&Math.abs(i.y)<Fe&&(i.x=0,i.y=0)}const e=I.getPosition(),t=e.y,o=e.x-w.position.x,r=t-w.position.z;return o!==0||r!==0?(w.position.set(e.x,T,t),Ke(e.x,T,t),n.firstPersonModeActive||(te.makeRotationZ(-o/T),w.matrix.premultiply(te),te.makeRotationX(r/T),w.matrix.premultiply(te),w.rotation.setFromRotationMatrix(w.matrix)),!0):!1}function eo(){return T}function to(e){w.visible=!e}let Q,ge,F,J=0,Ve=()=>{console.warn("gUpdateMazePosition not set")};const oo=new N(0,0),Ze=Math.PI/4,no=Math.sin(Ze),io=Math.cos(Ze);function ro(e){Nt(e)}function Be(e){typeof e=="function"&&(Ve=e),[ge,Q]=Qt(e),F=new le(16769248,l.playerLightLevel),F.castShadow=!1,n.scene.add(F),n.playerLight=F}function Le(){if(_!==0||O!==0){let t;if(_!==0&&O!==0?t=new N(_*io,O*no):t=new N(_,O),t.mul(l.keyForce),n.firstPersonModeActive){const o=Math.cos(J),r=Math.sin(J),i=o*t.x-r*t.y,s=r*t.x+o*t.y;t.x=i,t.y=s}lo(t)}n.playerLight.position.x=Q.position.x,n.playerLight.position.z=Q.position.z;const e=Jt();return e&&(n.idleStartMs=0,n.idleMode=!1),!e&&!n.idleMode&&(n.idleStartMs===0?n.idleStartMs=Date.now():Date.now()-n.idleStartMs>l.idleTimeout*1e3&&(n.idleMode=!0)),e}function so(e){ge.setLinearVelocity(e)}function qe(e){so(oo),ao(e.start.x,e.start.z),J=-e.start.angle,F.position.set(e.start.x,l.lightYpos,e.start.z),F.intensity=0}function ao(e,t){const o=he();Q.position.set(e,o.y,t),ge.setPosition({x:e,y:t}),Ve(e,o.y,t)}function he(){return Q.position}function Ne(){return eo()}function lo(e){ge.applyForceToCenter(e)}function Qe(){return J}function Je(e){J=e}function Pe(e){to(e)}const co="player.js",fo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:co,getAngle:Qe,getCameraHeight:Ne,getPosition:he,hideMesh:Pe,loadAssets:ro,setAngle:Je,setNewMaze:qe,setup:Be,update:Le},Symbol.toStringTag,{value:"Module"}));let y;function uo(e=document.body){n.renderUpdate=Ae,n.cameraYpos=l.defaultCameraY,n.scene=new mt,n.camera=new xt(80,window.innerWidth/window.innerHeight),n.renderer=new wt({antialias:!0}),n.renderer.shadowMap.enabled=l.enableShadows,n.renderer.shadowMap.type=Mt,e.appendChild(n.renderer.domElement),n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",ho),n.scene.background=new Ee(l.bgColour),y=new bt(16777215,l.sunLightLevel),y.castShadow=!0,y.position.set(5,20,5),y.shadow.camera.left=-10,y.shadow.camera.right=10,y.shadow.camera.top=0,y.shadow.camera.bottom=-20,y.shadow.camera.near=10,y.shadow.camera.far=25,n.scene.add(y),n.fog=new Lt(l.bgColour,5,10),n.scene.fog=n.fog}function Ae(e=!0){let t=!1;if(!n.orbitControlsEnabled){const o=he();if(n.firstPersonModeActive)n.camera.position.x=o.x,n.camera.position.z=o.z;else{const r=o.x-n.camera.position.x,i=o.z-n.camera.position.z;if(r!==0||i!==0){t=!0;const s=n.mazeExited?l.cameraExitEase:l.cameraEase;s>=1||Math.abs(r)<.008&&Math.abs(i)<.008?(n.camera.position.x=o.x,n.camera.position.z=o.z):(n.camera.position.x+=r*s,n.camera.position.z+=i*s)}}}(e||t)&&n.renderer.render(n.scene,n.camera)}function po(){const e=.1*(l.playerLightLevel-n.playerLight.intensity),t=.1*(l.sunLightLevel-y.intensity);return n.playerLight.intensity+=e,y.intensity+=t,e<.01?(n.playerLight.intensity=l.playerLightLevel,n.exitLight.intensity=l.exitLightLevel,y.intensity=l.sunLightLevel,!0):!1}function go(){const e=.04*n.playerLight.intensity;return n.playerLight.intensity-=e,n.exitLight.intensity-=e,y.intensity-=e/2,e<.01?(n.playerLight.intensity=0,n.exitLight.intensity=0,y.intensity=0,!0):!1}function ho(){n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight),Ae()}const X={},C={},ie={},K={};let G=null;function yo(e){const t=new Pt(e);t.setResponseType("arraybuffer");for(const o in ie)Object.hasOwn(ie,o)&&t.load(l.soundsDir+ie[o],r=>{X[o]=r.transfer()})}function De(e){for(const t in e)Object.hasOwn(e,t)&&(ie[t]=e[t])}function ke(e){for(const t in e)Object.hasOwn(e,t)&&(K[t]=e[t])}function et(){document.body.addEventListener("click",()=>{mo()},{once:!0})}function mo(){G===null&&(G=new vt,n.camera.add(G));const e=new AudioContext;for(const t in X)Object.hasOwn(X,t)&&(C[t]||(C[t]=new St(G),e.decodeAudioData(X[t],o=>{C[t].setBuffer(o),C[t].setLoop(!1),X[t]=null})))}function ye(e){return G===null?!0:C[e]?(C[e].isPlaying&&C[e].stop(),C[e].play(),!0):!1}function tt(e){if(G===null)return!0;if(K[e]){const t=K[e].length;if(t>0){const o=Math.floor(Math.random()*t),r=K[e][o];return ye(r)?!0:(K[e].splice(o,1),!1)}else return!1}return!1}const xo="sounds.js",wo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:xo,addAssets:De,addGroups:ke,loadAssets:yo,play:ye,playFromGroup:tt,setup:et},Symbol.toStringTag,{value:"Module"})),ot=Math.PI/2,Mo=new Ee(16711680),bo=new Ee(65280);let P,Te,E,U,W,V,M,v=null,Ce,ze,Y,Re=!1,de=!1;function nt(){P=n.scene,Te=n.exitLight,V=new le(16766720,0),P.add(V),U=new le(16766720,0),P.add(U),Ce=new we(.5,.04),ze=new we(.04,.5),Re=!0}function Lo(e){const t=new Et(e);t.load(l.modelDir+l.keyModelFile,o=>{E=o.scene,E.traverse(r=>{r instanceof pe&&(r.material.emissive={b:0,r:1,g:.7,isColor:!0},r.material.emissiveIntensity=.55)}),E.scale.set(.6,.6,.6)},void 0,()=>{E=n.errorMesh.clone()}),t.load(l.modelDir+l.baseModelFile,o=>{W=o.scene,W.scale.set(.35,.1,.35)},void 0,()=>{W=n.errorMesh.clone()}),t.load(l.modelDir+l.doorModelFile,o=>{M=o.scene,M.scale.set(.42,.4,.3)},void 0,()=>{M=n.errorMesh.clone()}),De(l.keySounds),ke(l.keySoundGroups)}function it(e){if(!Re||(Y=e,v!==null&&(n.physicsWorld.destroyBody(v),v=null),P.remove(E),P.remove(W),P.remove(M),V.intensity=0,U.intensity=0,de=!1,e.deadends.length===0))return;const t=Math.floor(Math.random()*e.deadends.length);e.key=e.deadends[t],e.data[e.key.x][e.key.z]="K";const{x:o,z:r}=Y.exit;Y.data[o][r]="L";let i=e.exit.x,s=e.exit.z,c;e.exit.dir==="L"||e.exit.dir==="R"?(M.rotation.set(0,ot,0),i+=e.exit.dir==="R"?.5:-.5,c=ze):(M.rotation.set(0,0,0),s+=e.exit.dir==="D"?.5:-.5,c=Ce);const p={type:"static",position:{x:i,y:s}};v=n.physicsWorld.createBody(p),v.createFixture({shape:c}),W.position.set(e.key.x,0,e.key.z),P.add(W),V.position.set(e.key.x,.1,e.key.z),V.intensity=.04,E.position.set(e.key.x,.38,e.key.z),P.add(E),U.position.set(e.key.x,.44,e.key.z),U.intensity=.1,de=!0,M.position.set(i,0,s),P.add(M),Te.color=Mo}function rt(){return!Re||!de||n.idleMode?!1:(E.rotateY(.03),E.rotateZ(.03),!0)}function st(){P.remove(E),U.intensity=0,de=!1,ye("keyPickup");const{x:e,z:t}=Y.exit;Y.data[e][t]="H",v!==null&&(n.physicsWorld.destroyBody(v),v=null);const o=Y.exit.dir;let r=M.position.x,i=M.position.z,s,c=0;o==="L"||o==="R"?(r+=o==="R"?.5:-.5,i+=.5,s=Ce):(c=ot,r+=.5,i+=o==="D"?.5:-.5,s=ze);const p={type:"static",position:{x:r,y:i}};v=n.physicsWorld.createBody(p),v.createFixture({shape:s}),M.position.set(r,0,i),M.rotation.set(0,c,0),Te.color=bo}const Po="key.js",vo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Po,collect:st,create:it,loadAssets:Lo,setup:nt,update:rt},Symbol.toStringTag,{value:"Module"})),Ge=Math.PI/2,fe=[],ue=[],oe=[],h={x:0,z:0,type:""};let H,re,Z,D,L,$;function at(){H=n.scene,re=n.camera,Z=new le(65280,0),H.add(Z),n.exitLight=Z,$={size:{x:0,z:0}}}function So(e){const t=new We(e);for(const o of l.wallTextureFiles)t.load(l.textureDir+"walls/"+o,r=>{r.colorSpace=Me,fe.push(r)},void 0,()=>{fe.push(n.errorTexture)});for(const o of l.floorTextureFiles)t.load(l.textureDir+"floors/"+o,r=>{r.colorSpace=Me,ue.push(r)},void 0,()=>{ue.push(n.errorTexture)});De(l.mazeSounds),ke(l.mazeSoundGroups)}function lt(e){$=e,oe.length>0&&(oe.forEach(a=>n.physicsWorld.destroyBody(a)),oe.length=0);const t={type:"static",position:{x:0,y:0}},o=new we(.5,.5);for(let a=0;a<e.size.x;a++)for(let d=0;d<e.size.z;d++)if(e.data[a][d]===!1){t.position={x:a,y:d};const f=n.physicsWorld.createBody(t);oe.push(f),f.createFixture({shape:o})}const r=e.size.x,i=e.size.z;D&&(H.remove(D),D.geometry.dispose(),D.material.dispose(),D=null),L&&(H.remove(L),L.geometry.dispose(),L.material.dispose(),L=null),D=Eo(e),D.castShadow=!0,D.receiveShadow=!0,H.add(D);const s=Math.floor(Math.random()*ue.length),c=ue[s];c.wrapS=c.wrapT=At,c.repeat.set(r+15,i+15);const p=new Dt(r+15,i+15),u=new je({map:c});L=new pe(p,u),L.rotateX(-Ge),L.position.set((r-1)/2,0,(i-1)/2),L.receiveShadow=!0,H.add(L),n.firstPersonModeActive?re.rotation.set(0,e.start.angle,0):re.rotation.set(-Ge,0,0),re.position.set(e.start.x,n.cameraYpos,e.start.z),Z.position.set(e.exit.x,l.exitLightY,e.exit.z),Z.intensity=0,n.mazeExited=!1}function Eo(e){const t=new kt(1,l.mazeHeight,1),o=Math.floor(Math.random()*fe.length),r=fe[o],i=new je({map:r}),s=new Tt(t,i,e.size.x*e.size.z);s.count=0;const c=new Ue;for(let p=0;p<e.size.x;p++)for(let u=0;u<e.size.z;u++)e.data[p][u]===!1&&(c.setPosition(p,l.mazeHeight/2,u),s.setMatrixAt(s.count++,c));return s}function ct(e,t,o){const r=Math.floor(e+.5),i=Math.floor(o+.5),s=h.x,c=h.z;if(r===s&&i===c)return;const p=h.type;h.x=r,h.z=i,r>=0&&r<$.size.x&&i>=0&&i<$.size.z?h.type=$.data[h.x][h.z]:h.type="O",h.type!==p&&(h.type==="K"&&(st(),$.data[h.x][h.z]="D"),h.type==="L"&&ye("locked"))}function dt(){return h}const Ao="maze.js",Do=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Ao,create:lt,getPlayerGridInfo:dt,loadAssets:So,setup:at,updatePlayerPosition:ct},Symbol.toStringTag,{value:"Module"}));var B=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(d){d.preventDefault(),r(++e%t.children.length)},!1);function o(d){return t.appendChild(d.dom),d}function r(d){for(var f=0;f<t.children.length;f++)t.children[f].style.display=f===d?"block":"none";e=d}var i=(performance||Date).now(),s=i,c=0,p=o(new B.Panel("FPS","#0ff","#002")),u=o(new B.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=o(new B.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:o,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){c++;var d=(performance||Date).now();if(u.update(d-i,200),d>=s+1e3&&(p.update(c*1e3/(d-s),100),s=d,c=0,a)){var f=performance.memory;a.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return d},update:function(){i=this.end()},domElement:t,setMode:r}};B.Panel=function(e,t,o){var r=1/0,i=0,s=Math.round,c=s(window.devicePixelRatio||1),p=80*c,u=48*c,a=3*c,d=2*c,f=3*c,A=15*c,b=74*c,x=30*c,z=document.createElement("canvas");z.width=p,z.height=u,z.style.cssText="width:80px;height:48px";var g=z.getContext("2d");return g.font="bold "+9*c+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=o,g.fillRect(0,0,p,u),g.fillStyle=t,g.fillText(e,a,d),g.fillRect(f,A,b,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(f,A,b,x),{dom:z,update:function(ee,ut){r=Math.min(r,ee),i=Math.max(i,ee),g.fillStyle=o,g.globalAlpha=1,g.fillRect(0,0,p,A),g.fillStyle=t,g.fillText(s(ee)+" "+e+" ("+s(r)+"-"+s(i)+")",a,d),g.drawImage(z,f+c,A,b-c,x,f,A,b-c,x),g.fillRect(f+b-c,A,c,x),g.fillStyle=o,g.globalAlpha=.9,g.fillRect(f+b-c,A,c,s((1-ee/ut)*x))}}};let me=!1,S,q,He,ve;function ko(){ve=new B,document.body.appendChild(ve.dom),be("orbit_controls",Co),be("house_lights",zo),S=new Ct(n.camera,n.renderer.domElement),S.enableDamping=!0,S.enabled=!1,S.minPolarAngle=.02,S.maxPolarAngle=Math.PI-.05,q=new zt(13421772,1),q.intensity=0,n.scene.add(q)}function To(){return ve.update(),n.orbitControlsEnabled?(S.update(),!0):!1}function Co(){if(n.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}n.orbitControlsEnabled=!n.orbitControlsEnabled;const e=he();n.orbitControlsEnabled?(console.log("Orbit controls enabled"),He=n.camera.position.y,S.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),n.camera.position.x=e.x,n.camera.position.y=He,n.camera.position.z=e.z,n.camera.rotation.set(3*Math.PI/2,0,0),n.renderUpdate()),S.enabled=n.orbitControlsEnabled}function zo(){me=!me,me?(q.intensity=1,n.scene.fog=null,console.log("House lights up")):(q.intensity=0,n.scene.fog=n.fog,console.log("House lights down")),n.renderUpdate()}function Ro(){S&&S.target.set(n.camera.position.x,l.ballRadius,n.camera.position.z)}const R=new _t(0,0,0,"YZX"),xe=new Rt,_o="pointerLockElement"in document;let se=0,ae=0;const Se=Math.PI/2;function Oo(){if(!_o){console.log("browser does not support pointer lock, first person view will not be available");return}be("first_person",Fo),addEventListener("pointerlockchange",()=>{if(n.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}n.firstPersonModeActive?(document.exitPointerLock(),n.camera.rotation.set(-Se,0,0),n.camera.position.y=n.cameraYpos=l.defaultCameraY,Zt($e),Pe(!1),n.firstPersonModeActive=!1,console.log("first person view disabled")):(n.camera.rotation.set(0,-Qe(),0),n.camera.position.y=n.cameraYpos=Ne(),Vt($e),Pe(!0),n.firstPersonModeActive=!0,console.log("first person view enabled")),n.renderUpdate()})}function Fo(){n.firstPersonModeActive?document.exitPointerLock():n.renderer.domElement.requestPointerLock()}function $e(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;se=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*l.mouseSensitivity,ae=t*l.mouseSensitivity}function Go(){if(!n.firstPersonModeActive)return!1;let e=!1;return(se!==0||ae!==0)&&(R.setFromQuaternion(n.camera.quaternion),R.x-=se,R.y-=ae,R.x=Math.max(-Se,Math.min(Se,R.x)),n.camera.quaternion.setFromEuler(R),n.camera.getWorldDirection(xe),Je(Math.atan2(xe.x,-xe.z)),se=0,ae=0,e=!0),e}Math.random=l.randomSeed?_e(l.randomSeed):_e();n.errorTexture=Io();n.errorMesh=Uo();const m=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Ie=1,k=m.init;document.addEventListener("DOMContentLoaded",()=>{Ho([fo,Do,vo,wo],$o)});function Ho(e,t){let o=!1,r=!1;const i=new Ot;i.onError=s=>{console.warn("Failed to load asset:",s),r=!0},i.onLoad=()=>{o&&(r&&console.error("LoadingManager: finished loading asset files with errors"),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(i):console.warn(s,"has no loadAssets method")}),o=!0}function $o(){Bt(),uo(),at(),Be(ct),nt(),Kt(),ko(),Oo(),et(),requestAnimationFrame(ft)}function ft(){let e=!0;switch(k){case m.init:{const t=jt(Ie);lt(t),it(t),qe(t),Ro(),k=m.fadeIn}break;case m.fadeIn:po()&&(k=m.play);break;case m.play:e=Le(),e|=Go(),e|=rt(),dt().type==="O"&&(Ie++,n.mazeExited=!0,k=m.fadeOut,tt("mazeExit"));break;case m.fadeOut:Le(),go()&&(k=m.pause);break;case m.pause:setTimeout(()=>{k=m.init},800),k=m.idle;break;case m.idle:break;default:console.log("game_loop(): Unknown game state: "+k),k=m.pause;break}e|=To(),qt(),Ae(e),requestAnimationFrame(ft)}function Io(){const o=new Uint8Array(1024);for(let i=0;i<1024;i+=4)o[i]=255,o[i+1]=105,o[i+2]=180,o[i+3]=255;const r=new Ft(o,16,16);return r.needsUpdate=!0,r}function Uo(){const e=new Ye(.1),t=new Gt({color:16738740});return new pe(e,t)}
