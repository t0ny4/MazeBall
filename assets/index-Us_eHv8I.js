import{N as W,G as nt}from"./keystrokes-zXtNIVHG.js";import{W as it,V as K,C as rt,B as ue}from"./planck-BHduNLkk.js";import{M as ze,T as Re,S as pe,a as _e,b as st,c as ae,P as oe,d as at,e as lt,W as ct,f as dt,C as we,D as ft,F as ut,G as pt,R as gt,g as ht,h as Fe,B as yt,I as mt,O as xt,A as wt,V as Mt,E as bt,i as Lt,j as vt,L as Pt}from"./three-hkB4yEKb.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function Se(...e){let t,n,i,r;if(e.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),e=[a[0],a[1],a[2]]}s(e);function s(a){const c=d();t=c(" "),n=c(" "),i=c(" "),r=1;for(let f=0;f<a.length;f++)t-=c(a[f]),t<0&&(t+=1),n-=c(a[f]),n<0&&(n+=1),i-=c(a[f]),i<0&&(i+=1)}function d(){let a=4022871197;function c(f){f=f.toString();const A=f.length;for(let b=0;b<A;b++){a+=f.charCodeAt(b);let x=.02519603282416938*a;a=x>>>0,x-=a,x*=a,a=x>>>0,x-=a,a+=x*4294967296}return(a>>>0)*23283064365386963e-26}return c}function g(a){return parseInt(a,10)===a}function u(){const a=2091639*t+r*23283064365386963e-26;return t=n,n=i,i=a-(r=a|0),i}return u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.int32=function(){return u()*4294967296},u.cycle=function(a){a=typeof a>"u"?1:Number(a),a<1&&(a=1);for(let c=0;c<a;c++)u()},u.range=function(a=0,c=0){if(a===0&&c===0)return 0;if(a>c){const f=a;a=c,c=f}return g(a)&&g(c)?Math.floor(u()*(c-a+1))+a:u()*(c-a)+a},u.restart=function(){s(e)},u.seed=function(...a){s(a)},u}const St={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null},Et={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},o=new Proxy(Object.seal(St),Et),At={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Tt={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},l=new Proxy(Object.freeze(At),Tt),Dt=Math.PI/2;function kt(e){const t=5+e*2,n=t,i={size:{x:t,z:n},data:Array.from({length:t},()=>Array(n).fill(!1)),deadends:[],key:!1},r=zt(i.size);return i.start=r.start,i.start.angle=0,i.end=r.end,i.exit=r.exit,i.data[i.exit.x][i.exit.z]="H",i}function Ct(e){const t=kt(e);Oe(t,t.start.x,t.start.z);const{x:n,z:i}=t.start;let r=0;if(t.data[n-1][i]!==!1?r=1:t.data[n][i+1]!==!1?r=2:t.data[n+1][i]!==!1&&(r=3),t.data[t.start.x][t.start.z]="S",t.data[t.end.x][t.end.z]="E",t.start.angle=r*Dt,t.deadends.length>0){const s=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[s],t.data[t.key.x][t.key.z]="K"}return t}function Oe(e,t,n){let i=t===e.end.x&&n===e.end.z;for(;;){const r=[];let s;if(n<e.size.z-3&&e.data[t][n+2]===!1&&r.push([0,1]),t<e.size.x-3&&e.data[t+2][n]===!1&&r.push([1,0]),n>2&&e.data[t][n-2]===!1&&r.push([0,-1]),t>2&&e.data[t-2][n]===!1&&r.push([-1,0]),r.length===0)return i?e.data[t][n]="*":e.data[t][n]===!1&&(e.data[t][n]="D",e.deadends.push({x:t,z:n})),i;if(e.data[t][n]=".",r.length===1?[s]=r:s=r[Math.floor(Math.random()*r.length)],Oe(e,t+s[0]*2,n+s[1]*2)?(e.data[t+s[0]][n+s[1]]="*",i=!0):e.data[t+s[0]][n+s[1]]=".",r.length===1)return i&&(e.data[t][n]="*"),i}}function zt(e){const t={},n={};let i=Math.random()>.5,r=Math.random()>.5;t.x=r?1:e.x-2,t.z=i?1:e.z-2;const s=Math.random();s>.5?(i=!i,r=!r):s>.25?i=!i:r=!r,n.x=r?1:e.x-2;const d=r?-1:1;n.z=i?1:e.z-2;const g=i?-1:1,u={...n};return Math.random()>.5?(n.z+=g,n.dir=i?"U":"D"):(n.x+=d,n.dir=r?"L":"R"),{start:t,end:u,exit:n}}let R=0,_=0;function Rt(){function e(){_+=1}function t(){_-=1}function n(){R-=1}function i(){R+=1}W(l.controlKeys.up,{onPressed:t,onReleased:e}),W(l.controlKeys.down,{onPressed:e,onReleased:t}),W(l.controlKeys.left,{onPressed:n,onReleased:i}),W(l.controlKeys.right,{onPressed:i,onReleased:n})}function _t(e){addEventListener("pointermove",e,!1)}function Ft(e){removeEventListener("pointermove",e)}function ge(e,t){if(!l.keys[e]){console.error("Unknown key index: "+e);return}const n=l.keys[e];n.includes(">")?nt(n,t):W(n,t)}let ne;function Ot(){ne=new it({gravity:new K(0,0)}),o.physicsWorld=ne}function Ht(){ne.step(1/60),ne.clearForces()}const Ee=new K(0,0),N=new ze,k=l.ballRadius,Ae=l.minVelocity;let w,I,Q,He=()=>{console.warn("gUpdateMazePosition not set")};function It(e){new Re(e).load(l.textureDir+"ball/"+l.ballTextureFile,n=>{Q=n,Q.colorSpace=pe},void 0,()=>{Q=o.errorTexture})}function $t(e){typeof e=="function"&&(He=e),I=o.physicsWorld.createBody({type:"dynamic",position:Ee,awake:!1,fixedRotation:!0}),I.createFixture({shape:new rt(Ee,k),restitution:.15,density:.2});const t=new _e(k),n=new st({map:Q});return w=new ae(t,n),w.position.y=k,w.castShadow=!0,o.scene.add(w),[I,w]}function Ut(){if(I.isAwake()){const r=I.getLinearVelocity();r.mul(.98),Math.abs(r.x)<Ae&&Math.abs(r.y)<Ae&&(r.x=0,r.y=0)}const e=I.getPosition(),t=e.y,n=e.x-w.position.x,i=t-w.position.z;return n!==0||i!==0?(w.position.set(e.x,k,t),He(e.x,k,t),o.firstPersonModeActive||(N.makeRotationZ(-n/k),w.matrix.premultiply(N),N.makeRotationX(i/k),w.matrix.premultiply(N),w.rotation.setFromRotationMatrix(w.matrix)),!0):!1}function Wt(){return k}function Gt(e){w.visible=!e}let V,le,F,Z=0,Ie=()=>{console.warn("gUpdateMazePosition not set")};const Yt=new K(0,0),$e=Math.PI/4,Xt=Math.sin($e),jt=Math.cos($e);function Kt(e){It(e)}function Ue(e){typeof e=="function"&&(Ie=e),[le,V]=$t(e),F=new oe(16769248,l.playerLightLevel),F.castShadow=!1,o.scene.add(F),o.playerLight=F}function he(){if(R!==0||_!==0){let t;if(R!==0&&_!==0?t=new K(R*jt,_*Xt):t=new K(R,_),t.mul(l.keyForce),o.firstPersonModeActive){const n=Math.cos(Z),i=Math.sin(Z),r=n*t.x-i*t.y,s=i*t.x+n*t.y;t.x=r,t.y=s}Bt(t)}o.playerLight.position.x=V.position.x,o.playerLight.position.z=V.position.z;const e=Ut();return e&&(o.idleStartMs=0,o.idleMode=!1),!e&&!o.idleMode&&(o.idleStartMs===0?o.idleStartMs=Date.now():Date.now()-o.idleStartMs>l.idleTimeout*1e3&&(o.idleMode=!0)),e}function Vt(e){le.setLinearVelocity(e)}function We(e){Vt(Yt),Zt(e.start.x,e.start.z),Z=-e.start.angle,F.position.set(e.start.x,l.lightYpos,e.start.z),F.intensity=0}function Zt(e,t){const n=ce();V.position.set(e,n.y,t),le.setPosition({x:e,y:t}),Ie(e,n.y,t)}function ce(){return V.position}function Ge(){return Wt()}function Bt(e){le.applyForceToCenter(e)}function Ye(){return Z}function Xe(e){Z=e}function ye(e){Gt(e)}const Nt="player.js",qt=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Nt,getAngle:Ye,getCameraHeight:Ge,getPosition:ce,hideMesh:ye,loadAssets:Kt,setAngle:Xe,setNewMaze:We,setup:Ue,update:he},Symbol.toStringTag,{value:"Module"}));let h;function Qt(e=document.body){o.renderUpdate=Me,o.cameraYpos=l.defaultCameraY,o.scene=new at,o.camera=new lt(80,window.innerWidth/window.innerHeight),o.renderer=new ct({antialias:!0}),o.renderer.shadowMap.enabled=l.enableShadows,o.renderer.shadowMap.type=dt,e.appendChild(o.renderer.domElement),o.renderer.setPixelRatio(window.devicePixelRatio),o.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",to),o.scene.background=new we(l.bgColour),h=new ft(16777215,l.sunLightLevel),h.castShadow=!0,h.position.set(5,20,5),h.shadow.camera.left=-10,h.shadow.camera.right=10,h.shadow.camera.top=0,h.shadow.camera.bottom=-20,h.shadow.camera.near=10,h.shadow.camera.far=25,o.scene.add(h),o.fog=new ut(l.bgColour,5,10),o.scene.fog=o.fog}function Me(e=!0){let t=!1;if(!o.orbitControlsEnabled){const n=ce();if(o.firstPersonModeActive)o.camera.position.x=n.x,o.camera.position.z=n.z;else{const i=n.x-o.camera.position.x,r=n.z-o.camera.position.z;if(i!==0||r!==0){t=!0;const s=o.mazeExited?l.cameraExitEase:l.cameraEase;s>=1||Math.abs(i)<.008&&Math.abs(r)<.008?(o.camera.position.x=n.x,o.camera.position.z=n.z):(o.camera.position.x+=i*s,o.camera.position.z+=r*s)}}}(e||t)&&o.renderer.render(o.scene,o.camera)}function Jt(){const e=.1*(l.playerLightLevel-o.playerLight.intensity),t=.1*(l.sunLightLevel-h.intensity);return o.playerLight.intensity+=e,h.intensity+=t,e<.01?(o.playerLight.intensity=l.playerLightLevel,o.exitLight.intensity=l.exitLightLevel,h.intensity=l.sunLightLevel,!0):!1}function eo(){const e=.04*o.playerLight.intensity;return o.playerLight.intensity-=e,o.exitLight.intensity-=e,h.intensity-=e/2,e<.01?(o.playerLight.intensity=0,o.exitLight.intensity=0,h.intensity=0,!0):!1}function to(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight),Me()}const je=Math.PI/2,oo=new we(16711680),no=new we(65280);let v,be,E,$,U,G,M,P=null,Le,ve,Ke,Pe=!1,ie=!1;function Ve(){v=o.scene,be=o.exitLight,G=new oe(16766720,0),v.add(G),$=new oe(16766720,0),v.add($),Le=new ue(.5,.04),ve=new ue(.04,.5),Pe=!0}function io(e){const t=new pt(e);t.load(l.modelDir+l.keyModelFile,n=>{E=n.scene,E.traverse(i=>{i instanceof ae&&(i.material.emissive={b:0,r:1,g:.7,isColor:!0},i.material.emissiveIntensity=.55)}),E.scale.set(.6,.6,.6)},void 0,()=>{E=o.errorMesh.clone()}),t.load(l.modelDir+l.baseModelFile,n=>{U=n.scene,U.scale.set(.35,.1,.35)},void 0,()=>{U=o.errorMesh.clone()}),t.load(l.modelDir+l.doorModelFile,n=>{M=n.scene,M.scale.set(.42,.4,.3)},void 0,()=>{M=o.errorMesh.clone()})}function Ze(e){if(!Pe||(Ke=e,P!==null&&(o.physicsWorld.destroyBody(P),P=null),v.remove(E),v.remove(U),v.remove(M),G.intensity=0,$.intensity=0,ie=!1,e.key===!1))return;let t=e.exit.x,n=e.exit.z,i;e.exit.dir==="L"||e.exit.dir==="R"?(M.rotation.set(0,je,0),t+=e.exit.dir==="R"?.5:-.5,i=ve):(M.rotation.set(0,0,0),n+=e.exit.dir==="D"?.5:-.5,i=Le);const r={type:"static",position:{x:t,y:n}};P=o.physicsWorld.createBody(r),P.createFixture({shape:i}),U.position.set(e.key.x,0,e.key.z),v.add(U),G.position.set(e.key.x,.1,e.key.z),G.intensity=.04,E.position.set(e.key.x,.38,e.key.z),v.add(E),$.position.set(e.key.x,.44,e.key.z),$.intensity=.1,ie=!0,M.position.set(t,0,n),v.add(M),be.color=oo}function Be(){return!Pe||!ie||o.idleMode?!1:(E.rotateY(.03),E.rotateZ(.03),!0)}function Ne(){v.remove(E),$.intensity=0,ie=!1,P!==null&&(o.physicsWorld.destroyBody(P),P=null);const e=Ke.exit.dir;let t=M.position.x,n=M.position.z,i,r=0;e==="L"||e==="R"?(t+=e==="R"?.5:-.5,n+=.5,i=Le):(r=je,t+=.5,n+=e==="D"?.5:-.5,i=ve);const s={type:"static",position:{x:t,y:n}};P=o.physicsWorld.createBody(s),P.createFixture({shape:i}),M.position.set(t,0,n),M.rotation.set(0,r,0),be.color=no}const ro="key.js",so=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:ro,collect:Ne,create:Ze,loadAssets:io,setup:Ve,update:Be},Symbol.toStringTag,{value:"Module"})),Te=Math.PI/2,re=[],se=[],q=[],y={x:0,z:0,type:""};let O,J,Y,T,L,H;function qe(){O=o.scene,J=o.camera,Y=new oe(65280,0),O.add(Y),o.exitLight=Y,H={size:{x:0,z:0}}}function ao(e){const t=new Re(e);for(const n of l.wallTextureFiles)t.load(l.textureDir+"walls/"+n,i=>{i.colorSpace=pe,re.push(i)},void 0,()=>{re.push(o.errorTexture)});for(const n of l.floorTextureFiles)t.load(l.textureDir+"floors/"+n,i=>{i.colorSpace=pe,se.push(i)},void 0,()=>{se.push(o.errorTexture)})}function Qe(e){H=e,q.length>0&&(q.forEach(a=>o.physicsWorld.destroyBody(a)),q.length=0);const t={type:"static",position:{x:0,y:0}},n=new ue(.5,.5);for(let a=0;a<e.size.x;a++)for(let c=0;c<e.size.z;c++)if(e.data[a][c]===!1){t.position={x:a,y:c};const f=o.physicsWorld.createBody(t);q.push(f),f.createFixture({shape:n})}const i=e.size.x,r=e.size.z;T&&(O.remove(T),T.geometry.dispose(),T.material.dispose(),T=null),L&&(O.remove(L),L.geometry.dispose(),L.material.dispose(),L=null),T=lo(e),T.castShadow=!0,T.receiveShadow=!0,O.add(T);const s=Math.floor(Math.random()*se.length),d=se[s];d.wrapS=d.wrapT=gt,d.repeat.set(i+15,r+15);const g=new ht(i+15,r+15),u=new Fe({map:d});L=new ae(g,u),L.rotateX(-Te),L.position.set((i-1)/2,0,(r-1)/2),L.receiveShadow=!0,O.add(L),o.firstPersonModeActive?J.rotation.set(0,e.start.angle,0):J.rotation.set(-Te,0,0),J.position.set(e.start.x,o.cameraYpos,e.start.z),Y.position.set(e.exit.x,l.exitLightY,e.exit.z),Y.intensity=0,o.mazeExited=!1}function lo(e){const t=new yt(1,l.mazeHeight,1),n=Math.floor(Math.random()*re.length),i=re[n],r=new Fe({map:i}),s=new mt(t,r,e.size.x*e.size.z);s.count=0;const d=new ze;for(let g=0;g<e.size.x;g++)for(let u=0;u<e.size.z;u++)e.data[g][u]===!1&&(d.setPosition(g,l.mazeHeight/2,u),s.setMatrixAt(s.count++,d));return s}function Je(e,t,n){const i=Math.floor(e+.5),r=Math.floor(n+.5),s=y.x,d=y.z;if(i===s&&r===d)return;const g=y.type;y.x=i,y.z=r,i>=0&&i<H.size.x&&r>=0&&r<H.size.z?y.type=H.data[y.x][y.z]:y.type="O",y.type!==g&&y.type==="K"&&(Ne(),H.data[y.x][y.z]="D")}function et(){return y}const co="maze.js",fo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:co,create:Qe,getPlayerGridInfo:et,loadAssets:ao,setup:qe,updatePlayerPosition:Je},Symbol.toStringTag,{value:"Module"}));var X=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(c){c.preventDefault(),i(++e%t.children.length)},!1);function n(c){return t.appendChild(c.dom),c}function i(c){for(var f=0;f<t.children.length;f++)t.children[f].style.display=f===c?"block":"none";e=c}var r=(performance||Date).now(),s=r,d=0,g=n(new X.Panel("FPS","#0ff","#002")),u=n(new X.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=n(new X.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){d++;var c=(performance||Date).now();if(u.update(c-r,200),c>=s+1e3&&(g.update(d*1e3/(c-s),100),s=c,d=0,a)){var f=performance.memory;a.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return c},update:function(){r=this.end()},domElement:t,setMode:i}};X.Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,d=s(window.devicePixelRatio||1),g=80*d,u=48*d,a=3*d,c=2*d,f=3*d,A=15*d,b=74*d,x=30*d,C=document.createElement("canvas");C.width=g,C.height=u,C.style.cssText="width:80px;height:48px";var p=C.getContext("2d");return p.font="bold "+9*d+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=n,p.fillRect(0,0,g,u),p.fillStyle=t,p.fillText(e,a,c),p.fillRect(f,A,b,x),p.fillStyle=n,p.globalAlpha=.9,p.fillRect(f,A,b,x),{dom:C,update:function(B,ot){i=Math.min(i,B),r=Math.max(r,B),p.fillStyle=n,p.globalAlpha=1,p.fillRect(0,0,g,A),p.fillStyle=t,p.fillText(s(B)+" "+e+" ("+s(i)+"-"+s(r)+")",a,c),p.drawImage(C,f+d,A,b-d,x,f,A,b-d,x),p.fillRect(f+b-d,A,d,x),p.fillStyle=n,p.globalAlpha=.9,p.fillRect(f+b-d,A,d,s((1-B/ot)*x))}}};let de=!1,S,j,De,me;function uo(){me=new X,document.body.appendChild(me.dom),ge("orbit_controls",go),ge("house_lights",ho),S=new xt(o.camera,o.renderer.domElement),S.enableDamping=!0,S.enabled=!1,S.minPolarAngle=.02,S.maxPolarAngle=Math.PI-.05,j=new wt(13421772,1),j.intensity=0,o.scene.add(j)}function po(){return me.update(),o.orbitControlsEnabled?(S.update(),!0):!1}function go(){if(o.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}o.orbitControlsEnabled=!o.orbitControlsEnabled;const e=ce();o.orbitControlsEnabled?(console.log("Orbit controls enabled"),De=o.camera.position.y,S.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),o.camera.position.x=e.x,o.camera.position.y=De,o.camera.position.z=e.z,o.camera.rotation.set(3*Math.PI/2,0,0),o.renderUpdate()),S.enabled=o.orbitControlsEnabled}function ho(){de=!de,de?(j.intensity=1,o.scene.fog=null,console.log("House lights up")):(j.intensity=0,o.scene.fog=o.fog,console.log("House lights down")),o.renderUpdate()}function yo(){S&&S.target.set(o.camera.position.x,l.ballRadius,o.camera.position.z)}const z=new bt(0,0,0,"YZX"),fe=new Mt,mo="pointerLockElement"in document;let ee=0,te=0;const xe=Math.PI/2;function xo(){if(!mo){console.log("browser does not support pointer lock, first person view will not be available");return}ge("first_person",wo),addEventListener("pointerlockchange",()=>{if(o.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}o.firstPersonModeActive?(document.exitPointerLock(),o.camera.rotation.set(-xe,0,0),o.camera.position.y=o.cameraYpos=l.defaultCameraY,Ft(ke),ye(!1),o.firstPersonModeActive=!1,console.log("first person view disabled")):(o.camera.rotation.set(0,-Ye(),0),o.camera.position.y=o.cameraYpos=Ge(),_t(ke),ye(!0),o.firstPersonModeActive=!0,console.log("first person view enabled")),o.renderUpdate()})}function wo(){o.firstPersonModeActive?document.exitPointerLock():o.renderer.domElement.requestPointerLock()}function ke(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;ee=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*l.mouseSensitivity,te=t*l.mouseSensitivity}function Mo(){if(!o.firstPersonModeActive)return!1;let e=!1;return(ee!==0||te!==0)&&(z.setFromQuaternion(o.camera.quaternion),z.x-=ee,z.y-=te,z.x=Math.max(-xe,Math.min(xe,z.x)),o.camera.quaternion.setFromEuler(z),o.camera.getWorldDirection(fe),Xe(Math.atan2(fe.x,-fe.z)),ee=0,te=0,e=!0),e}Math.random=l.randomSeed?Se(l.randomSeed):Se();o.errorTexture=vo();o.errorMesh=Po();const m=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Ce=1,D=m.init;document.addEventListener("DOMContentLoaded",()=>{bo([qt,fo,so],Lo)});function bo(e,t){let n=!1,i=!1;const r=new Pt;r.onError=s=>{console.warn("Failed to load asset:",s),i=!0},r.onLoad=()=>{n&&(i&&console.error("LoadingManager: finished loading asset files with errors"),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(r):console.warn(s,"has no loadAssets method")}),n=!0}function Lo(){Ot(),Qt(),qe(),Ue(Je),Ve(),Rt(),uo(),xo(),requestAnimationFrame(tt)}function tt(){let e=!0;switch(D){case m.init:{const t=Ct(Ce);Qe(t),Ze(t),We(t),yo(),D=m.fadeIn}break;case m.fadeIn:Jt()&&(D=m.play);break;case m.play:e=he(),e|=Mo(),e|=Be(),et().type==="O"&&(Ce++,o.mazeExited=!0,D=m.fadeOut);break;case m.fadeOut:he(),eo()&&(D=m.pause);break;case m.pause:setTimeout(()=>{D=m.init},800),D=m.idle;break;case m.idle:break;default:console.log("game_loop(): Unknown game state: "+D),D=m.pause;break}e|=po(),Ht(),Me(e),requestAnimationFrame(tt)}function vo(){const n=new Uint8Array(1024);for(let r=0;r<1024;r+=4)n[r]=255,n[r+1]=105,n[r+2]=180,n[r+3]=255;const i=new Lt(n,16,16);return i.needsUpdate=!0,i}function Po(){const e=new _e(.1),t=new vt({color:16738740});return new ae(e,t)}
