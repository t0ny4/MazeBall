import{N as _,G as Xe}from"./keystrokes-zXtNIVHG.js";import{W as Ze,V as Y,C as Pe,B as Ve}from"./planck-BHduNLkk.js";import{T as ue,S as V,a as qe,M as Ne,b as J,c as ve,P as q,d as Qe,e as Je,W as et,f as tt,C as pe,D as ot,F as nt,g as rt,h as it,G as st,R as Ee,L as Ae,i as at,j as Se,B as lt,I as ct,O as dt,A as ft,V as ut,E as pt}from"./three-zYCX_BhR.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function he(){let e,t,n,i,r=Array.prototype.slice.call(arguments);if(r.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),r=[a[0],a[1],a[2]]}s(r);function s(a){const c=d();e=c(" "),t=c(" "),n=c(" "),i=1;for(let u=0;u<a.length;u++)e-=c(a[u]),e<0&&(e+=1),t-=c(a[u]),t<0&&(t+=1),n-=c(a[u]),n<0&&(n+=1)}function d(){let a=4022871197;var c=function(u){u=u.toString();const Be=u.length;for(let oe=0;oe<Be;oe++){a+=u.charCodeAt(oe);var E=.02519603282416938*a;a=E>>>0,E-=a,E*=a,a=E>>>0,E-=a,a+=E*4294967296}return(a>>>0)*23283064365386963e-26};return c}function h(a){return parseInt(a,10)===a}const f=function(){const a=2091639*e+i*23283064365386963e-26;return e=t,t=n,n=a-(i=a|0)};return f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.int32=function(){return f()*4294967296},f.cycle=function(a){a=typeof a>"u"?1:+a,a<1&&(a=1);for(let c=0;c<a;c++)f()},f.range=function(a=0,c=0){if(a===0&&c===0)return 0;if(a>c){const u=a;a=c,c=u}return h(a)&&h(c)?Math.floor(f()*(c-a+1))+a:f()*(c-a)+a},f.restart=function(){s(r)},f.seed=function(){s(Array.prototype.slice.call(arguments))},f}const gt={_MODULE:"global.js",cameraYpos:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{},scene:null},yt={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},o=new Proxy(Object.seal(gt),yt),ht={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128",randomSeed:0,barrierHeight:.5,barrierRadius:.15,modelDir:"./models",barrierTextureFile:"Roof13.png",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},mt={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},l=new Proxy(Object.freeze(ht),mt),xt=Math.PI/2;function wt(e){const t=5+e*2,n=t,i={size:{x:t,z:n},data:Array.from({length:t},()=>Array(n).fill(!1)),deadends:[],key:!1};let r=bt(i.size);return i.start=r.start,i.start.angle=0,i.end=r.end,i.exit=r.exit,i.data[i.exit.x][i.exit.z]="H",i}function Mt(e){const t=wt(e);ke(t,t.start.x,t.start.z);const n=t.start.x,i=t.start.z;let r=0;if(t.data[n-1][i]!==!1?r=1:t.data[n][i+1]!==!1?r=2:t.data[n+1][i]!==!1&&(r=3),t.data[t.start.x][t.start.z]="S",t.data[t.end.x][t.end.z]="E",t.start.angle=r*xt,t.deadends.length>0){const s=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[s],t.data[t.key.x][t.key.z]="K"}return t}function ke(e,t,n){let i=t===e.end.x&&n===e.end.z;for(;;){const r=[];let s;if(n<e.size.z-3&&e.data[t][n+2]===!1&&r.push([0,1]),t<e.size.x-3&&e.data[t+2][n]===!1&&r.push([1,0]),n>2&&e.data[t][n-2]===!1&&r.push([0,-1]),t>2&&e.data[t-2][n]===!1&&r.push([-1,0]),r.length==0)return i?e.data[t][n]="*":e.data[t][n]===!1&&(e.data[t][n]="D",e.deadends.push({x:t,z:n})),i;if(e.data[t][n]=".",r.length==1?s=r[0]:s=r[Math.floor(Math.random()*r.length)],ke(e,t+s[0]*2,n+s[1]*2)?(e.data[t+s[0]][n+s[1]]="*",i=!0):e.data[t+s[0]][n+s[1]]=".",r.length==1)return i&&(e.data[t][n]="*"),i}}function bt(e){const t={},n={};let i=Math.random()>.5,r=Math.random()>.5;t.x=r?1:e.x-2,t.z=i?e.z-2:1;const s=Math.random();s>.5?(i=!i,r=!r):s>.25?i=!i:r=!r,n.x=r?1:e.x-2;const d=r?-1:1;n.z=i?e.z-2:1;const h=i?1:-1,f={...n};return Math.random()>.5?n.z+=h:n.x+=d,{start:t,end:f,exit:n}}let S=0,k=0;function Lt(){function e(){k+=1}function t(){k-=1}function n(){S-=1}function i(){S+=1}_(l.controlKeys.up,{onPressed:t,onReleased:e}),_(l.controlKeys.down,{onPressed:e,onReleased:t}),_(l.controlKeys.left,{onPressed:n,onReleased:i}),_(l.controlKeys.right,{onPressed:i,onReleased:n})}function Pt(e){addEventListener("pointermove",e,!1)}function vt(e){removeEventListener("pointermove",e)}function ie(e,t){if(!l.keys[e]){console.error("Unknown key index: "+e);return}const n=l.keys[e];n.includes(">")?Xe(n,t):_(n,t)}let N;function Et(){N=new Ze({gravity:new Y(0,0)}),o.physicsWorld=N}function At(){N.step(1/60),N.clearForces()}const me=new Y(0,0),K=new ve,v=l.ballRadius,xe=l.minVelocity;let m,F,se,Ce=()=>{console.warn("gUpdateMazePosition not set")};function St(){return new Promise((e,t)=>{new ue().load(l.textureDir+"/ball/"+l.ballTextureFile,i=>{se=i,se.colorSpace=V,e(!0)},null,i=>{t("failed to load texture "+i.target.src)})})}function kt(e){typeof e=="function"&&(Ce=e),F=o.physicsWorld.createBody({type:"dynamic",position:me,awake:!1,fixedRotation:!0}),F.createFixture({shape:new Pe(me,v),restitution:.15,density:.2});const t=new qe(v),n=new Ne({map:se});return m=new J(t,n),m.position.y=v,m.castShadow=!0,o.scene.add(m),[F,m]}function Ct(){if(F.isAwake()){const r=F.getLinearVelocity();r.mul(.98),Math.abs(r.x)<xe&&Math.abs(r.y)<xe&&(r.x=0,r.y=0)}const e=F.getPosition(),t=e.y,n=e.x-m.position.x,i=t-m.position.z;return n!==0||i!==0?(m.position.set(e.x,v,t),Ce(e.x,v,t),o.firstPersonModeActive||(K.makeRotationZ(-n/v),m.matrix.premultiply(K),K.makeRotationX(i/v),m.matrix.premultiply(K),m.rotation.setFromRotationMatrix(m.matrix)),!0):!1}function zt(){return v}function Tt(e){m.visible=!e}let U,ee,C,G=0,ze=()=>{console.warn("gUpdateMazePosition not set")};const Ot=new Y(0,0),Te=Math.PI/4,Ft=Math.sin(Te),Dt=Math.cos(Te);function _t(){return St()}function Oe(e){typeof e=="function"&&(ze=e),[ee,U]=kt(e),C=new q(16769248,l.playerLightLevel),C.castShadow=!1,o.scene.add(C),o.playerLight=C}function ae(){if(S!=0||k!=0){let e;if(S!=0&&k!=0?e=new Y(S*Dt,k*Ft):e=new Y(S,k),e.mul(l.keyForce),o.firstPersonModeActive){const t=Math.cos(G),n=Math.sin(G),i=t*e.x-n*e.y,r=n*e.x+t*e.y;e.x=i,e.y=r}It(e)}return o.playerLight.position.x=U.position.x,o.playerLight.position.z=U.position.z,Ct()}function Rt(e){ee.setLinearVelocity(e)}function Fe(e){Rt(Ot),$t(e.start.x,e.start.z),G=-e.start.angle,C.position.set(e.start.x,l.lightYpos,e.start.z),C.intensity=0}function $t(e,t){const n=te();U.position.set(e,n.y,t),ee.setPosition({x:e,y:t}),ze(e,n.y,t)}function te(){return U.position}function De(){return zt()}function It(e){ee.applyForceToCenter(e)}function _e(){return G}function Re(e){G=e}function le(e){Tt(e)}const Ht="player.js",Wt=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Ht,getAngle:_e,getCameraHeight:De,getPosition:te,hideMesh:le,loadAssets:_t,setAngle:Re,setNewMaze:Fe,setup:Oe,update:ae},Symbol.toStringTag,{value:"Module"}));let p;function Yt(e=document.body){o.renderUpdate=ge,o.cameraYpos=l.defaultCameraY,o.scene=new Qe,o.camera=new Je(80,window.innerWidth/window.innerHeight),o.renderer=new et({antialias:!0}),o.renderer.shadowMap.enabled=l.enableShadows,o.renderer.shadowMap.type=tt,e.appendChild(o.renderer.domElement),o.renderer.setPixelRatio(window.devicePixelRatio),o.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",Kt),o.scene.background=new pe(l.bgColour),p=new ot(16777215,l.sunLightLevel),p.castShadow=!0,p.position.set(5,20,5),p.shadow.camera.left=-10,p.shadow.camera.right=10,p.shadow.camera.top=0,p.shadow.camera.bottom=-20,p.shadow.camera.near=10,p.shadow.camera.far=25,o.scene.add(p),o.fog=new nt(l.bgColour,5,10),o.scene.fog=o.fog}function ge(e=!0){if(!o.orbitControlsEnabled){const t=te();if(o.firstPersonModeActive)o.camera.position.x=t.x,o.camera.position.z=t.z;else{const n=t.x-o.camera.position.x,i=t.z-o.camera.position.z;if(n!=0||i!=0){e=!0;const r=o.mazeExited?l.cameraExitEase:l.cameraEase;r>=1||Math.abs(n)<.008&&Math.abs(i)<.008?(o.camera.position.x=t.x,o.camera.position.z=t.z):(o.camera.position.x+=n*r,o.camera.position.z+=i*r)}}}e&&o.renderer.render(o.scene,o.camera)}function Ut(){const e=.1*(l.playerLightLevel-o.playerLight.intensity),t=.1*(l.sunLightLevel-p.intensity);return o.playerLight.intensity+=e,p.intensity+=t,e<.01?(o.playerLight.intensity=l.playerLightLevel,o.exitLight.intensity=l.exitLightLevel,p.intensity=l.sunLightLevel,!0):!1}function Gt(){const e=.04*o.playerLight.intensity;return o.playerLight.intensity-=e,o.exitLight.intensity-=e,p.intensity-=e/2,e<.01?(o.playerLight.intensity=0,o.exitLight.intensity=0,p.intensity=0,!0):!1}function Kt(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight),ge()}const jt=new rt(l.barrierRadius,l.barrierHeight),Bt=new pe(16711680),Xt=new pe(65280);let w,ye,z=null,Q,R,P,D,$,I,$e=!1;function Ie(){w=o.scene,ye=o.exitLight,I=new q(16766720,0),w.add(I),D=new q(16766720,0),w.add(D);const e=new it({map:R});Q=new J(jt,e),$e=!0}function Zt(){return new Promise((e,t)=>{const n=new Ae;n.onLoad=()=>{e(!0)},n.onError=s=>{t("failed to load texture "+s)};const i=new st(n);i.setPath(l.modelDir+"/"),i.load(l.keyModelFile,s=>{P=s.scene,P.traverse(d=>{d instanceof J&&(d.material.emissive={b:0,r:1,g:.7,isColor:!0},d.material.emissiveIntensity=.55)}),P.scale.set(.6,.6,.6),P.rotateZ(-.4),P.rotateY(.5)}),i.load(l.baseModelFile,s=>{$=s.scene,$.scale.set(.35,.1,.35)}),R=new ue(n).load(l.textureDir+"/misc/"+l.barrierTextureFile),R.colorSpace=V,R.wrapS=R.wrapT=Ee})}function He(e){if(!$e||(z!==null&&(o.physicsWorld.destroyBody(z),z=null),w.remove(P),w.remove($),I.intensity=0,D.intensity=0,e.key===!1))return;const t=new Pe(l.barrierRadius),n={type:"static",position:{x:e.exit.x,y:e.exit.z}},i=o.physicsWorld.createBody(n);z=i,i.createFixture({shape:t}),$.position.set(e.key.x,0,e.key.z),w.add($),I.position.set(e.key.x,.1,e.key.z),I.intensity=.04,P.position.set(e.key.x,.3,e.key.z),w.add(P),D.position.set(e.key.x,.3,e.key.z),D.intensity=.1,Q.position.set(e.exit.x,l.barrierHeight/2,e.exit.z),w.add(Q),ye.color=Bt}function We(){w.remove(P),D.intensity=0,z!==null&&o.physicsWorld.destroyBody(z),ye.color=Xt,w.remove(Q)}const Vt="key.js",qt=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Vt,collect:We,create:He,loadAssets:Zt,setup:Ie},Symbol.toStringTag,{value:"Module"})),we=Math.PI/2,ce=[],de=[],j=[],g={x:0,z:0,type:""};let T,B,H,b,x,O;function Ye(){T=o.scene,B=o.camera,H=new q(65280,0),T.add(H),o.exitLight=H,O={size:{x:0,z:0}}}function Nt(){return new Promise((e,t)=>{const n=new Ae;n.onLoad=()=>{e(!0)},n.onError=r=>{t("failed to load texture "+r)};const i=new ue(n);for(const r of l.wallTextureFiles){const s=i.load(l.textureDir+"/walls/"+r);s.colorSpace=V,ce.push(s)}for(const r of l.floorTextureFiles){const s=i.load(l.textureDir+"/floors/"+r);s.colorSpace=V,de.push(s)}})}function Ue(e){O=e,j.length>0&&(j.forEach(a=>o.physicsWorld.destroyBody(a)),j.length=0);const t={type:"static",position:{x:0,y:0}},n=new Ve(.5,.5);for(let a=0;a<e.size.x;a++)for(let c=0;c<e.size.z;c++)if(e.data[a][c]===!1){t.position={x:a,y:c};const u=o.physicsWorld.createBody(t);j.push(u),u.createFixture({shape:n})}const i=e.size.x,r=e.size.z;b&&(T.remove(b),b.geometry.dispose(),b.material.dispose(),b=null),x&&(T.remove(x),x.geometry.dispose(),x.material.dispose(),x=null),b=Qt(e),b.castShadow=!0,b.receiveShadow=!0,T.add(b);const s=Math.floor(Math.random()*de.length),d=de[s];d.wrapS=d.wrapT=Ee,d.repeat.set(i+15,r+15);const h=new at(i+15,r+15),f=new Se({map:d});x=new J(h,f),x.rotateX(-we),x.position.set((i-1)/2,0,(r-1)/2),x.receiveShadow=!0,T.add(x),o.firstPersonModeActive?B.rotation.set(0,e.start.angle,0):B.rotation.set(-we,0,0),B.position.set(e.start.x,o.cameraYpos,e.start.z),H.position.set(e.exit.x,l.exitLightY,e.exit.z),H.intensity=0,o.mazeExited=!1}function Qt(e){const t=new lt(1,l.mazeHeight,1),n=Math.floor(Math.random()*ce.length),i=ce[n],r=new Se({map:i}),s=new ct(t,r,e.size.x*e.size.z);s.count=0;const d=new ve;for(let h=0;h<e.size.x;h++)for(let f=0;f<e.size.z;f++)e.data[h][f]===!1&&(d.setPosition(h,l.mazeHeight/2,f),s.setMatrixAt(s.count++,d));return s}function Ge(e,t,n){const i=Math.floor(e+.5),r=Math.floor(n+.5),s=g.x,d=g.z;if(i===s&&r===d)return;const h=g.type;g.x=i,g.z=r,i>=0&&i<O.size.x&&r>=0&&r<O.size.z?g.type=O.data[g.x][g.z]:g.type="O",g.type!==h&&g.type==="K"&&(We(),O.data[g.x][g.z]="D")}function Ke(){return g}const Jt="maze.js",eo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Jt,create:Ue,getPlayerGridInfo:Ke,loadAssets:Nt,setup:Ye,updatePlayerPosition:Ge},Symbol.toStringTag,{value:"Module"}));let ne=!1,M,W,Me;function to(){ie("orbit_controls",no),ie("house_lights",ro),M=new dt(o.camera,o.renderer.domElement),M.enableDamping=!0,M.enabled=!1,M.minPolarAngle=.02,M.maxPolarAngle=Math.PI-.05,W=new ft(13421772,1),W.intensity=0,o.scene.add(W)}function oo(){return o.orbitControlsEnabled?(M.update(),!0):!1}function no(){if(o.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}o.orbitControlsEnabled=!o.orbitControlsEnabled;const e=te();o.orbitControlsEnabled?(console.log("Orbit controls enabled"),Me=o.camera.position.y,M.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),o.camera.position.x=e.x,o.camera.position.y=Me,o.camera.position.z=e.z,o.camera.rotation.set(3*Math.PI/2,0,0),o.renderUpdate()),M.enabled=o.orbitControlsEnabled}function ro(){ne=!ne,ne?(W.intensity=1,o.scene.fog=null,console.log("House lights up")):(W.intensity=0,o.scene.fog=o.fog,console.log("House lights down")),o.renderUpdate()}function io(){M&&M.target.set(o.camera.position.x,l.ballRadius,o.camera.position.z)}const A=new pt(0,0,0,"YZX"),re=new ut,so="pointerLockElement"in document;let X=0,Z=0;const fe=Math.PI/2;function ao(){if(!so){console.log("browser does not support pointer lock, first person view will not be available");return}ie("first_person",lo),addEventListener("pointerlockchange",()=>{if(o.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}o.firstPersonModeActive?(document.exitPointerLock(),o.camera.rotation.set(-fe,0,0),o.camera.position.y=o.cameraYpos=l.defaultCameraY,vt(be),le(!1),o.firstPersonModeActive=!1,console.log("first person view disabled")):(o.camera.rotation.set(0,-_e(),0),o.camera.position.y=o.cameraYpos=De(),Pt(be),le(!0),o.firstPersonModeActive=!0,console.log("first person view enabled")),o.renderUpdate()})}function lo(){o.firstPersonModeActive?document.exitPointerLock():o.renderer.domElement.requestPointerLock()}function be(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;X=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*l.mouseSensitivity,Z=t*l.mouseSensitivity}function co(){if(!o.firstPersonModeActive)return!1;let e=!1;return(X!==0||Z!==0)&&(A.setFromQuaternion(o.camera.quaternion),A.x-=X,A.y-=Z,A.x=Math.max(-fe,Math.min(fe,A.x)),o.camera.quaternion.setFromEuler(A),o.camera.getWorldDirection(re),Re(Math.atan2(re.x,-re.z)),X=0,Z=0,e=!0),e}Math.random=l.randomSeed?he(l.randomSeed):he();const y=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Le=1,L=y.init;document.addEventListener("DOMContentLoaded",()=>{fo([Wt,eo,qt],uo)});async function fo(e,t){const n=[];e.forEach(i=>{if(typeof i.loadAssets=="function"){const r=i.loadAssets();r instanceof Promise?n.push(r):console.warn(i,"loadAssets() did not return a promise, it returned",r)}else console.warn(i,"has no loadAssets method")});for(let i=0;i<n.length;i++)try{await n[i]}catch(r){console.warn("loadAssets():",r)}t()}function uo(){Et(),Yt(),Ye(),Oe(Ge),Ie(),Lt(),to(),ao(),requestAnimationFrame(je)}function je(){let e=!0;switch(L){case y.init:{const t=Mt(Le);Ue(t),He(t),Fe(t),io(),L=y.fadeIn}break;case y.fadeIn:Ut()&&(L=y.play);break;case y.play:e=ae(),e|=co(),Ke().type==="O"&&(Le++,o.mazeExited=!0,L=y.fadeOut);break;case y.fadeOut:ae(),Gt()&&(L=y.pause);break;case y.pause:setTimeout(()=>{L=y.init},800),L=y.idle;break;case y.idle:break;default:console.log("game_loop(): Unknown game state: "+L),L=y.pause;break}e|=oo(),At(),ge(e),requestAnimationFrame(je)}
