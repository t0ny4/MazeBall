import{N as j,G as xt}from"./keystrokes-zXtNIVHG.js";import{W as wt,V as Q,C as Mt,B as be}from"./planck-D8CQOpC-.js";import{M as Ye,T as je,S as Le,a as Ke,b as bt,c as me,P as ce,d as Lt,e as vt,W as Pt,f as St,C as De,D as Et,F as At,g as kt,A as Dt,h as zt,G as Tt,R as Ct,i as Rt,j as Xe,B as _t,I as Ot,O as Ft,k as It,V as Gt,E as Ht,L as $t,l as Ut,m as Wt}from"./three-DGGowSNC.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function ve(...e){let t,n,i,r;if(e.length===0){const a=new Uint32Array(3);window.crypto.getRandomValues(a),e=[a[0],a[1],a[2]]}s(e);function s(a){const d=l();t=d(" "),n=d(" "),i=d(" "),r=1;for(let p=0;p<a.length;p++)t-=d(a[p]),t<0&&(t+=1),n-=d(a[p]),n<0&&(n+=1),i-=d(a[p]),i<0&&(i+=1)}function l(){let a=4022871197;function d(p){p=p.toString();const A=p.length;for(let b=0;b<A;b++){a+=p.charCodeAt(b);let x=.02519603282416938*a;a=x>>>0,x-=a,x*=a,a=x>>>0,x-=a,a+=x*4294967296}return(a>>>0)*23283064365386963e-26}return d}function f(a){return parseInt(a,10)===a}function u(){const a=2091639*t+r*23283064365386963e-26;return t=n,n=i,i=a-(r=a|0),i}return u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.int32=function(){return u()*4294967296},u.cycle=function(a){a=typeof a>"u"?1:Number(a),a<1&&(a=1);for(let d=0;d<a;d++)u()},u.range=function(a=0,d=0){if(a===0&&d===0)return 0;if(a>d){const p=a;a=d,d=p}return f(a)&&f(d)?Math.floor(u()*(d-a+1))+a:u()*(d-a)+a},u.restart=function(){s(e)},u.seed=function(...a){s(a)},u}const Yt={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null},jt={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},o=new Proxy(Object.seal(Yt),jt),Kt={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,soundsDir:"./sounds/",modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",keySounds:{keyPickup:"DM-CGS-03.ogg"},keySoundGroups:{},ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],mazeSounds:{locked:{filename:"DM-CGS-10.ogg",volume:.3},dm12:{filename:"DM-CGS-12.ogg",volume:.25},dm26:{filename:"DM-CGS-26.ogg",volume:.4}},mazeSoundGroups:{mazeExit:["dm12","dm26"]},controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Xt={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},c=new Proxy(Object.freeze(Kt),Xt),Vt=Math.PI/2,O=ve();function Bt(e,t,n){const i=e<3?3:e|1,r=t<3?3:t|1,s={x:i,z:r},l=n===void 0?Math.random().toString().substring(2):n;O.seed(l);const f={size:s,data:Array.from({length:s.x},()=>Array(s.z).fill(!1)),deadends:[],seed:l},u=Nt(s);return f.start=u.start,f.start.angle=0,f.end=u.end,f.exit=u.exit,f.data[f.exit.x][f.exit.z]="H",f}function Zt(e,t,n){const i=Bt(e,t,n);Ve(i,i.start.x,i.start.z);const{x:r,z:s}=i.start;let l=0;return i.data[r-1][s]!==!1?l=1:i.data[r][s+1]!==!1?l=2:i.data[r+1][s]!==!1&&(l=3),i.data[i.start.x][i.start.z]="S",i.data[i.end.x][i.end.z]="E",i.start.angle=l*Vt,i}function Ve(e,t,n){let i=t===e.end.x&&n===e.end.z;for(;;){const r=[];let s;if(n<e.size.z-3&&e.data[t][n+2]===!1&&r.push([0,1]),t<e.size.x-3&&e.data[t+2][n]===!1&&r.push([1,0]),n>2&&e.data[t][n-2]===!1&&r.push([0,-1]),t>2&&e.data[t-2][n]===!1&&r.push([-1,0]),r.length===0)return i?e.data[t][n]="*":e.data[t][n]===!1&&(e.data[t][n]="D",e.deadends.push({x:t,z:n})),i;if(e.data[t][n]="",r.length===1?[s]=r:s=r[Math.floor(O()*r.length)],Ve(e,t+s[0]*2,n+s[1]*2)?(e.data[t+s[0]][n+s[1]]="*",i=!0):e.data[t+s[0]][n+s[1]]="",r.length===1)return i&&(e.data[t][n]="*"),i}}function Nt(e){const t={},n={};let i=O()>.5,r=O()>.5;t.x=r?1:e.x-2,t.z=i?1:e.z-2;const s=O();s>.5?(i=!i,r=!r):s>.25?i=!i:r=!r,n.x=r?1:e.x-2;const l=r?-1:1;n.z=i?1:e.z-2;const f=i?-1:1,u={...n};return O()>.5?(n.z+=f,n.dir=i?"U":"D"):(n.x+=l,n.dir=r?"L":"R"),{start:t,end:u,exit:n}}let F=0,I=0;function qt(){function e(){I+=1}function t(){I-=1}function n(){F-=1}function i(){F+=1}j(c.controlKeys.up,{onPressed:t,onReleased:e}),j(c.controlKeys.down,{onPressed:e,onReleased:t}),j(c.controlKeys.left,{onPressed:n,onReleased:i}),j(c.controlKeys.right,{onPressed:i,onReleased:n})}function Qt(e){addEventListener("pointermove",e,!1)}function Jt(e){removeEventListener("pointermove",e)}function Pe(e,t){if(!c.keys[e]){console.error("Unknown key index: "+e);return}const n=c.keys[e];n.includes(">")?xt(n,t):j(n,t)}let de;function en(){de=new wt({gravity:new Q(0,0)}),o.physicsWorld=de}function tn(){de.step(1/60),de.clearForces()}const Ie=new Q(0,0),ne=new Ye,T=c.ballRadius,Ge=c.minVelocity;let w,U,ie,Be=()=>{console.warn("gUpdateMazePosition not set")};function nn(e){new je(e).load(c.textureDir+"ball/"+c.ballTextureFile,n=>{ie=n,ie.colorSpace=Le},void 0,()=>{ie=o.errorTexture})}function on(e){typeof e=="function"&&(Be=e),U=o.physicsWorld.createBody({type:"dynamic",position:Ie,awake:!1,fixedRotation:!0}),U.createFixture({shape:new Mt(Ie,T),restitution:.15,density:.2});const t=new Ke(T),n=new bt({map:ie});return w=new me(t,n),w.position.y=T,w.castShadow=!0,o.scene.add(w),[U,w]}function rn(){if(U.isAwake()){const r=U.getLinearVelocity();r.mul(.98),Math.abs(r.x)<Ge&&Math.abs(r.y)<Ge&&(r.x=0,r.y=0)}const e=U.getPosition(),t=e.y,n=e.x-w.position.x,i=t-w.position.z;return n!==0||i!==0?(w.position.set(e.x,T,t),Be(e.x,T,t),o.firstPersonModeActive||(ne.makeRotationZ(-n/T),w.matrix.premultiply(ne),ne.makeRotationX(i/T),w.matrix.premultiply(ne),w.rotation.setFromRotationMatrix(w.matrix)),!0):!1}function sn(){return T}function an(e){w.visible=!e}let J,ye,G,ee=0,Ze=()=>{console.warn("gUpdateMazePosition not set")};const ln=new Q(0,0),Ne=Math.PI/4,cn=Math.sin(Ne),dn=Math.cos(Ne);function fn(e){nn(e)}function qe(e){typeof e=="function"&&(Ze=e),[ye,J]=on(e),G=new ce(16769248,c.playerLightLevel),G.castShadow=!1,o.scene.add(G),o.playerLight=G}function Se(){if(F!==0||I!==0){let t;if(F!==0&&I!==0?t=new Q(F*dn,I*cn):t=new Q(F,I),t.mul(c.keyForce),o.firstPersonModeActive){const n=Math.cos(ee),i=Math.sin(ee),r=n*t.x-i*t.y,s=i*t.x+n*t.y;t.x=r,t.y=s}gn(t)}o.playerLight.position.x=J.position.x,o.playerLight.position.z=J.position.z;const e=rn();return e&&(o.idleStartMs=0,o.idleMode=!1),!e&&!o.idleMode&&(o.idleStartMs===0?o.idleStartMs=Date.now():Date.now()-o.idleStartMs>c.idleTimeout*1e3&&(o.idleMode=!0)),e}function un(e){ye.setLinearVelocity(e)}function Qe(e){un(ln),pn(e.start.x,e.start.z),ee=-e.start.angle,G.position.set(e.start.x,c.lightYpos,e.start.z),G.intensity=0}function pn(e,t){const n=he();J.position.set(e,n.y,t),ye.setPosition({x:e,y:t}),Ze(e,n.y,t)}function he(){return J.position}function Je(){return sn()}function gn(e){ye.applyForceToCenter(e)}function et(){return ee}function tt(e){ee=e}function Ee(e){an(e)}const mn="player.js",yn=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:mn,getAngle:et,getCameraHeight:Je,getPosition:he,hideMesh:Ee,loadAssets:fn,setAngle:tt,setNewMaze:Qe,setup:qe,update:Se},Symbol.toStringTag,{value:"Module"}));let y;function hn(e=document.body){o.renderUpdate=ze,o.cameraYpos=c.defaultCameraY,o.scene=new Lt,o.camera=new vt(80,window.innerWidth/window.innerHeight),o.renderer=new Pt({antialias:!0}),o.renderer.shadowMap.enabled=c.enableShadows,o.renderer.shadowMap.type=St,e.appendChild(o.renderer.domElement),o.renderer.setPixelRatio(window.devicePixelRatio),o.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",Mn),o.scene.background=new De(c.bgColour),y=new Et(16777215,c.sunLightLevel),y.castShadow=!0,y.position.set(5,20,5),y.shadow.camera.left=-10,y.shadow.camera.right=10,y.shadow.camera.top=0,y.shadow.camera.bottom=-20,y.shadow.camera.near=10,y.shadow.camera.far=25,o.scene.add(y),o.fog=new At(c.bgColour,5,10),o.scene.fog=o.fog}function ze(e=!0){let t=!1;if(!o.orbitControlsEnabled){const n=he();if(o.firstPersonModeActive)o.camera.position.x=n.x,o.camera.position.z=n.z;else{const i=n.x-o.camera.position.x,r=n.z-o.camera.position.z;if(i!==0||r!==0){t=!0;const s=o.mazeExited?c.cameraExitEase:c.cameraEase;s>=1||Math.abs(i)<.008&&Math.abs(r)<.008?(o.camera.position.x=n.x,o.camera.position.z=n.z):(o.camera.position.x+=i*s,o.camera.position.z+=r*s)}}}(e||t)&&o.renderer.render(o.scene,o.camera)}function xn(){const e=.1*(c.playerLightLevel-o.playerLight.intensity),t=.1*(c.sunLightLevel-y.intensity);return o.playerLight.intensity+=e,y.intensity+=t,e<.01?(o.playerLight.intensity=c.playerLightLevel,o.exitLight.intensity=c.exitLightLevel,y.intensity=c.sunLightLevel,!0):!1}function wn(){const e=.04*o.playerLight.intensity;return o.playerLight.intensity-=e,o.exitLight.intensity-=e,y.intensity-=e/2,e<.01?(o.playerLight.intensity=0,o.exitLight.intensity=0,y.intensity=0,!0):!1}function Mn(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight),ze()}const K={},z={},C={},X={};let V=null,fe=!1,nt=!1;function bn(e){const t=new kt(e);t.setResponseType("arraybuffer");for(const n in C)Object.hasOwn(C,n)&&t.load(c.soundsDir+C[n].filename,i=>{K[n]=i.transfer()})}function Te(e){for(const t in e)if(Object.hasOwn(e,t)){const n=e[t];typeof n=="string"?C[t]={filename:n,volume:1}:typeof n=="object"&&n.filename&&(C[t]={filename:n.filename},C[t].volume=n.volume?n.volume:1)}}function Ce(e){for(const t in e)Object.hasOwn(e,t)&&(X[t]=e[t])}function ot(){document.body.addEventListener("click",()=>{fe||rt()},{once:!0}),nt=/firefox/i.test(navigator.userAgent),document.body.addEventListener("keydown",it,{once:!0})}function it(e){if(nt&&e.key.length>1){fe||document.body.addEventListener("keydown",it,{once:!0});return}fe||rt()}function rt(){V=new Dt,o.camera.add(V);const e=new AudioContext;for(const t in K)Object.hasOwn(K,t)&&(z[t]||(z[t]=new zt(V),e.decodeAudioData(K[t],n=>{z[t].setBuffer(n),z[t].setLoop(!1),z[t].setVolume(C[t].volume),delete K[t]})));fe=!0}function xe(e){return V===null?!0:z[e]?(z[e].isPlaying&&z[e].stop(),z[e].play(),!0):!1}function st(e){if(V===null)return!0;if(X[e]){const t=X[e].length;if(t>0){const n=Math.floor(Math.random()*t),i=X[e][n];return xe(i)?!0:(X[e].splice(n,1),!1)}else return!1}return!1}const Ln="sounds.js",vn=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Ln,addAssets:Te,addGroups:Ce,loadAssets:bn,play:xe,playFromGroup:st,setup:ot},Symbol.toStringTag,{value:"Module"})),at=Math.PI/2,Pn=new De(16711680),Sn=new De(65280);let v,Re,E,W,Y,B,M,P=null,_e,Oe,re,Fe=!1,ue=!1;function lt(){v=o.scene,Re=o.exitLight,B=new ce(16766720,0),v.add(B),W=new ce(16766720,0),v.add(W),_e=new be(.5,.04),Oe=new be(.04,.5),Fe=!0}function En(e){const t=new Tt(e);t.load(c.modelDir+c.keyModelFile,n=>{E=n.scene,E.traverse(i=>{i instanceof me&&(i.material.emissive={b:0,r:1,g:.7,isColor:!0},i.material.emissiveIntensity=.55)}),E.scale.set(.6,.6,.6)},void 0,()=>{E=o.errorMesh.clone()}),t.load(c.modelDir+c.baseModelFile,n=>{Y=n.scene,Y.scale.set(.35,.1,.35)},void 0,()=>{Y=o.errorMesh.clone()}),t.load(c.modelDir+c.doorModelFile,n=>{M=n.scene,M.scale.set(.42,.4,.3)},void 0,()=>{M=o.errorMesh.clone()}),Te(c.keySounds),Ce(c.keySoundGroups)}function ct(e){if(!Fe)return;P!==null&&(o.physicsWorld.destroyBody(P),P=null),v.remove(E),v.remove(Y),v.remove(M),B.intensity=0,W.intensity=0,ue=!1;const t=e;if(re=t,t.deadends.length===0){t.key=!1,t.keyIndex=!1;return}const n=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[n],t.keyIndex=n,t.data[t.key.x][t.key.z]="K";const{x:i,z:r}=t.exit;t.data[i][r]="L";let s=t.exit.x,l=t.exit.z,f;t.exit.dir==="L"||t.exit.dir==="R"?(M.rotation.set(0,at,0),s+=t.exit.dir==="R"?.5:-.5,f=Oe):(M.rotation.set(0,0,0),l+=t.exit.dir==="D"?.5:-.5,f=_e);const u={type:"static",position:{x:s,y:l}};P=o.physicsWorld.createBody(u),P.createFixture({shape:f}),Y.position.set(t.key.x,0,t.key.z),v.add(Y),B.position.set(t.key.x,.1,t.key.z),B.intensity=.04,E.position.set(t.key.x,.38,t.key.z),v.add(E),W.position.set(t.key.x,.44,t.key.z),W.intensity=.1,ue=!0,M.position.set(s,0,l),v.add(M),Re.color=Pn}function dt(){return!Fe||!ue||o.idleMode?!1:(E.rotateY(.03),E.rotateZ(.03),!0)}function ft(){v.remove(E),W.intensity=0,ue=!1,xe("keyPickup");const{x:e,z:t}=re.exit;re.data[e][t]="H",P!==null&&(o.physicsWorld.destroyBody(P),P=null);const n=re.exit.dir;let i=M.position.x,r=M.position.z,s,l=0;n==="L"||n==="R"?(i+=n==="R"?.5:-.5,r+=.5,s=_e):(l=at,i+=.5,r+=n==="D"?.5:-.5,s=Oe);const f={type:"static",position:{x:i,y:r}};P=o.physicsWorld.createBody(f),P.createFixture({shape:s}),M.position.set(i,0,r),M.rotation.set(0,l,0),Re.color=Sn}const An="key.js",kn=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:An,collect:ft,create:ct,loadAssets:En,setup:lt,update:dt},Symbol.toStringTag,{value:"Module"})),He=Math.PI/2,pe=[],ge=[],oe=[],m={x:0,z:0,type:""};let H,se,Z,k,L,$;function ut(){H=o.scene,se=o.camera,Z=new ce(65280,0),H.add(Z),o.exitLight=Z,$={size:{x:0,z:0}}}function Dn(e){const t=new je(e);for(const n of c.wallTextureFiles)t.load(c.textureDir+"walls/"+n,i=>{i.colorSpace=Le,pe.push(i)},void 0,()=>{pe.push(o.errorTexture)});for(const n of c.floorTextureFiles)t.load(c.textureDir+"floors/"+n,i=>{i.colorSpace=Le,ge.push(i)},void 0,()=>{ge.push(o.errorTexture)});Te(c.mazeSounds),Ce(c.mazeSoundGroups)}function pt(e){$=e,oe.length>0&&(oe.forEach(a=>o.physicsWorld.destroyBody(a)),oe.length=0);const t={type:"static",position:{x:0,y:0}},n=new be(.5,.5);for(let a=0;a<e.size.x;a++)for(let d=0;d<e.size.z;d++)if(e.data[a][d]===!1){t.position={x:a,y:d};const p=o.physicsWorld.createBody(t);oe.push(p),p.createFixture({shape:n})}const i=e.size.x,r=e.size.z;k&&(H.remove(k),k.geometry.dispose(),k.material.dispose(),k=null),L&&(H.remove(L),L.geometry.dispose(),L.material.dispose(),L=null),k=zn(e),k.castShadow=!0,k.receiveShadow=!0,H.add(k);const s=Math.floor(Math.random()*ge.length),l=ge[s];l.wrapS=l.wrapT=Ct,l.repeat.set(i+15,r+15);const f=new Rt(i+15,r+15),u=new Xe({map:l});L=new me(f,u),L.rotateX(-He),L.position.set((i-1)/2,0,(r-1)/2),L.receiveShadow=!0,H.add(L),o.firstPersonModeActive?se.rotation.set(0,e.start.angle,0):se.rotation.set(-He,0,0),se.position.set(e.start.x,o.cameraYpos,e.start.z),Z.position.set(e.exit.x,c.exitLightY,e.exit.z),Z.intensity=0,o.mazeExited=!1}function zn(e){const t=new _t(1,c.mazeHeight,1),n=Math.floor(Math.random()*pe.length),i=pe[n],r=new Xe({map:i}),s=new Ot(t,r,e.size.x*e.size.z);s.count=0;const l=new Ye;for(let f=0;f<e.size.x;f++)for(let u=0;u<e.size.z;u++)e.data[f][u]===!1&&(l.setPosition(f,c.mazeHeight/2,u),s.setMatrixAt(s.count++,l));return s}function gt(e,t,n){const i=Math.floor(e+.5),r=Math.floor(n+.5),s=m.x,l=m.z;if(i===s&&r===l)return;const f=m.type;m.x=i,m.z=r,i>=0&&i<$.size.x&&r>=0&&r<$.size.z?m.type=$.data[m.x][m.z]:m.type="O",m.type!==f&&(m.type==="K"&&(ft(),$.data[m.x][m.z]="D"),m.type==="L"&&xe("locked"))}function mt(){return m}const Tn="maze.js",Cn=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Tn,create:pt,getPlayerGridInfo:mt,loadAssets:Dn,setup:ut,updatePlayerPosition:gt},Symbol.toStringTag,{value:"Module"}));var N=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(d){d.preventDefault(),i(++e%t.children.length)},!1);function n(d){return t.appendChild(d.dom),d}function i(d){for(var p=0;p<t.children.length;p++)t.children[p].style.display=p===d?"block":"none";e=d}var r=(performance||Date).now(),s=r,l=0,f=n(new N.Panel("FPS","#0ff","#002")),u=n(new N.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=n(new N.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:n,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(u.update(d-r,200),d>=s+1e3&&(f.update(l*1e3/(d-s),100),s=d,l=0,a)){var p=performance.memory;a.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){r=this.end()},domElement:t,setMode:i}};N.Panel=function(e,t,n){var i=1/0,r=0,s=Math.round,l=s(window.devicePixelRatio||1),f=80*l,u=48*l,a=3*l,d=2*l,p=3*l,A=15*l,b=74*l,x=30*l,R=document.createElement("canvas");R.width=f,R.height=u,R.style.cssText="width:80px;height:48px";var g=R.getContext("2d");return g.font="bold "+9*l+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,f,u),g.fillStyle=t,g.fillText(e,a,d),g.fillRect(p,A,b,x),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(p,A,b,x),{dom:R,update:function(te,ht){i=Math.min(i,te),r=Math.max(r,te),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,f,A),g.fillStyle=t,g.fillText(s(te)+" "+e+" ("+s(i)+"-"+s(r)+")",a,d),g.drawImage(R,p+l,A,b-l,x,p,A,b-l,x),g.fillRect(p+b-l,A,l,x),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(p+b-l,A,l,s((1-te/ht)*x))}}};let we=!1,S,q,$e,Ae;function Rn(){Ae=new N,document.body.appendChild(Ae.dom),Pe("orbit_controls",On),Pe("house_lights",Fn),S=new Ft(o.camera,o.renderer.domElement),S.enableDamping=!0,S.enabled=!1,S.minPolarAngle=.02,S.maxPolarAngle=Math.PI-.05,q=new It(13421772,1),q.intensity=0,o.scene.add(q)}function _n(){return Ae.update(),o.orbitControlsEnabled?(S.update(),!0):!1}function On(){if(o.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}o.orbitControlsEnabled=!o.orbitControlsEnabled;const e=he();o.orbitControlsEnabled?(console.log("Orbit controls enabled"),$e=o.camera.position.y,S.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),o.camera.position.x=e.x,o.camera.position.y=$e,o.camera.position.z=e.z,o.camera.rotation.set(3*Math.PI/2,0,0),o.renderUpdate()),S.enabled=o.orbitControlsEnabled}function Fn(){we=!we,we?(q.intensity=1,o.scene.fog=null,console.log("House lights up")):(q.intensity=0,o.scene.fog=o.fog,console.log("House lights down")),o.renderUpdate()}function In(){S&&S.target.set(o.camera.position.x,c.ballRadius,o.camera.position.z)}const _=new Ht(0,0,0,"YZX"),Me=new Gt,Gn="pointerLockElement"in document;let ae=0,le=0;const ke=Math.PI/2;function Hn(){if(!Gn){console.log("browser does not support pointer lock, first person view will not be available");return}Pe("first_person",$n),addEventListener("pointerlockchange",()=>{if(o.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}o.firstPersonModeActive?(document.exitPointerLock(),o.camera.rotation.set(-ke,0,0),o.camera.position.y=o.cameraYpos=c.defaultCameraY,Jt(Ue),Ee(!1),o.firstPersonModeActive=!1,console.log("first person view disabled")):(o.camera.rotation.set(0,-et(),0),o.camera.position.y=o.cameraYpos=Je(),Qt(Ue),Ee(!0),o.firstPersonModeActive=!0,console.log("first person view enabled")),o.renderUpdate()})}function $n(){o.firstPersonModeActive?document.exitPointerLock():o.renderer.domElement.requestPointerLock()}function Ue(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;ae=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*c.mouseSensitivity,le=t*c.mouseSensitivity}function Un(){if(!o.firstPersonModeActive)return!1;let e=!1;return(ae!==0||le!==0)&&(_.setFromQuaternion(o.camera.quaternion),_.x-=ae,_.y-=le,_.x=Math.max(-ke,Math.min(ke,_.x)),o.camera.quaternion.setFromEuler(_),o.camera.getWorldDirection(Me),tt(Math.atan2(Me.x,-Me.z)),ae=0,le=0,e=!0),e}Math.random=c.randomSeed?ve(c.randomSeed):ve();o.errorTexture=jn();o.errorMesh=Kn();const h=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let We=1,D=h.init;document.addEventListener("DOMContentLoaded",()=>{Wn([yn,Cn,kn,vn],Yn)});function Wn(e,t){let n=!1,i=!1;const r=new $t;r.onError=s=>{console.warn("Failed to load asset:",s),i=!0},r.onLoad=()=>{n&&(i&&console.error("LoadingManager: finished loading asset files with errors"),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(r):console.warn(s,"has no loadAssets method")}),n=!0}function Yn(){en(),hn(),ut(),qe(gt),lt(),qt(),Rn(),Hn(),ot(),requestAnimationFrame(yt)}function yt(){let e=!0;switch(D){case h.init:{const t=Math.random().toString().substring(2),n=5+We*2,i=Zt(n,n,t);pt(i),ct(i),Qe(i),In(),D=h.fadeIn}break;case h.fadeIn:xn()&&(D=h.play);break;case h.play:e=Se(),e|=Un(),e|=dt(),mt().type==="O"&&(We++,o.mazeExited=!0,D=h.fadeOut,st("mazeExit"));break;case h.fadeOut:Se(),wn()&&(D=h.pause);break;case h.pause:setTimeout(()=>{D=h.init},800),D=h.idle;break;case h.idle:break;default:console.log("game_loop(): Unknown game state: "+D),D=h.pause;break}e|=_n(),tn(),ze(e),requestAnimationFrame(yt)}function jn(){const n=new Uint8Array(1024);for(let r=0;r<1024;r+=4)n[r]=255,n[r+1]=105,n[r+2]=180,n[r+3]=255;const i=new Ut(n,16,16);return i.needsUpdate=!0,i}function Kn(){const e=new Ke(.1),t=new Wt({color:16738740});return new me(e,t)}
