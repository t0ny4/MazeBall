import{D as Gt,S as rt,M as Ot,a as Pe,L as Wt,b as Ut,c as it,T as st,d as Ae,P as xe,E as at,e as Yt,f as Bt,W as Vt,g as Xt,C as We,h as Kt,F as Zt,O as qt,A as jt,V as Qt,i as Jt,j as Nt,k as en,G as tn,R as nn,l as on,m as lt,B as rn,I as sn}from"./three-DPIScPpj.js";import{W as an,V as re,C as ln,B as ze}from"./planck-C4Ttdjc7.js";import{N as K,G as cn}from"./keystrokes-BXin2WUB.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Te(...e){let t,n,r,i;if(e.length===0){const l=new Uint32Array(3);window.crypto.getRandomValues(l),e=[l[0],l[1],l[2]]}s(e);function s(l){const u=a();t=u(" "),n=u(" "),r=u(" "),i=1;for(let p=0;p<l.length;p++)t-=u(l[p]),t<0&&(t+=1),n-=u(l[p]),n<0&&(n+=1),r-=u(l[p]),r<0&&(r+=1)}function a(){let l=4022871197;function u(p){p=p.toString();const m=p.length;for(let w=0;w<m;w++){l+=p.charCodeAt(w);let M=.02519603282416938*l;l=M>>>0,M-=l,M*=l,l=M>>>0,M-=l,l+=M*4294967296}return(l>>>0)*23283064365386963e-26}return u}function f(l){return parseInt(l,10)===l}function d(){const l=2091639*t+i*23283064365386963e-26;return t=n,n=r,r=l-(i=l|0),r}return d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.int32=function(){return d()*4294967296},d.cycle=function(l){l=typeof l>"u"?1:Number(l),l<1&&(l=1);for(let u=0;u<l;u++)d()},d.range=function(l=0,u=0){if(l===0&&u===0)return 0;if(l>u){const p=l;l=u,u=p}return f(l)&&f(u)?Math.floor(d()*(u-l+1))+l:d()*(u-l)+l},d.restart=function(){s(e)},d.seed=function(...l){s(l)},d}const dn={_MODULE:"global.js",cameraYpos:0,idleStartMs:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,idleMode:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null,statusBar:null},fn={get(e,t){if(t in e)return e[t];throw console.error('Cannot read non existent property "'+t+'" from global'),new Error},set(e,t,n){if(t in e)return e[t]=n,!0;throw console.error('Cannot create new property "'+t+'" on global'),new Error},deleteProperty(e,t){throw console.error('Cannot delete property "'+t+'" from global'),new Error}},o=new Proxy(Object.seal(dn),fn),un={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,soundsDir:"./sounds/",modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",keySounds:{keyPickup:{filename:"DM-CGS-07.ogg",volume:.4}},keySoundGroups:{},ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],mazeSounds:{locked:{filename:"DM-CGS-10.ogg",volume:.3},dm12:{filename:"DM-CGS-12.ogg",volume:.25},dm26:{filename:"DM-CGS-26.ogg",volume:.4},wallhit:{filename:"DM-CGS-03.ogg",volume:.05}},mazeSoundGroups:{mazeExit:["dm12","dm26"]},controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,idleTimeout:15,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},pn={get(e,t){if(t in e)return e[t];throw console.error('Cannot read non existent property "'+t+'" from config'),new Error},set(e,t){throw console.error('Cannot write to property "'+t+'" on config'),new Error},deleteProperty(e,t){throw console.error('Cannot delete property "'+t+'" from config'),new Error}},c=new Proxy(Object.freeze(un),pn);let z=null,Qe=0,_e=0,Ue=0,Re=0,fe=0,Je=0;function gn(){return z=document.createElement("div"),z.id="statusBar",z.classList.add("status"),document.body.append(z),Qe=z===null?0:z.clientHeight,Qe}function Fe(...e){z&&(z.innerHTML=e.join(" "))}function yn(e){e!==_e&&(_e=e,Ue=0,Re=0,Ye())}function hn(){Ue++,Ye()}function mn(e){Re+=e,fe=Math.round(Re),fe!==Je&&(Je=fe,Ye())}function Ye(){z.innerHTML="Level: "+_e+" &nbsp; Distance Rolled: "+fe+" &nbsp; Wall Impacts: "+Ue}function xn(){const n=new Uint8Array(1024);for(let i=0;i<1024;i+=4)n[i]=255,n[i+1]=105,n[i+2]=180,n[i+3]=255;const r=new Gt(n,16,16);return r.needsUpdate=!0,r}function wn(){const e=new rt(.1),t=new Ot({color:16738740});return new Pe(e,t)}function Mn(e,t){let n=!1,r=!1;const i=new Wt;i.onError=s=>{console.warn("Failed to load asset:",s),r=!0},i.onProgress=function(s,a,f){Fe("Loaded",Math.floor(a/f*100)+"%")},i.onLoad=()=>{n&&(r&&console.error("LoadingManager: finished loading asset files with errors"),Fe(""),t())},e.forEach(s=>{typeof s.loadAssets=="function"?s.loadAssets(i):console.warn(s,"has no loadAssets method")}),n=!0}const bn=Math.PI/2,I=Te();function Ln(e,t,n){const r=e<3?3:e|1,i=t<3?3:t|1,s={x:r,z:i},a=n===void 0?Math.random().toString().substring(2):n;I.seed(a);const f={size:s,data:Array.from({length:s.x},()=>Array(s.z).fill(!1)),deadends:[],seed:a},d=Pn(s);return f.start=d.start,f.start.angle=0,f.end=d.end,f.exit=d.exit,f.data[f.exit.x][f.exit.z]="H",f}function vn(e,t,n){const r=Ln(e,t,n);ct(r,r.start.x,r.start.z);const{x:i,z:s}=r.start;let a=0;return r.data[i-1][s]!==!1?a=1:r.data[i][s+1]!==!1?a=2:r.data[i+1][s]!==!1&&(a=3),r.data[r.start.x][r.start.z]="S",r.data[r.end.x][r.end.z]="E",r.start.angle=a*bn,r}function ct(e,t,n){let r=t===e.end.x&&n===e.end.z;for(;;){const i=[];let s;if(n<e.size.z-3&&e.data[t][n+2]===!1&&i.push([0,1]),t<e.size.x-3&&e.data[t+2][n]===!1&&i.push([1,0]),n>2&&e.data[t][n-2]===!1&&i.push([0,-1]),t>2&&e.data[t-2][n]===!1&&i.push([-1,0]),i.length===0)return r?e.data[t][n]="*":e.data[t][n]===!1&&(e.data[t][n]="D",e.deadends.push({x:t,z:n})),r;if(e.data[t][n]="",i.length===1?[s]=i:s=i[Math.floor(I()*i.length)],ct(e,t+s[0]*2,n+s[1]*2)?(e.data[t+s[0]][n+s[1]]="*",r=!0):e.data[t+s[0]][n+s[1]]="",i.length===1)return r&&(e.data[t][n]="*"),r}}function Pn(e){const t={},n={};let r=I()>.5,i=I()>.5;t.x=i?1:e.x-2,t.z=r?1:e.z-2;const s=I();s>.5?(r=!r,i=!i):s>.25?r=!r:i=!i,n.x=i?1:e.x-2;const a=i?-1:1;n.z=r?1:e.z-2;const f=r?-1:1,d={...n};return I()>.5?(n.z+=f,n.dir=r?"U":"D"):(n.x+=a,n.dir=i?"L":"R"),{start:t,end:d,exit:n}}let J;const b={};function Sn(){J=new an({gravity:new re(0,0)}),o.physicsWorld=J,o.physicsWorld.addContactCallback=Dn,J.on("begin-contact",e=>{const t=e.m_nodeA.other.m_userData,n=e.m_nodeB.other.m_userData;if(t===void 0||n===void 0)return;const r=typeof t=="object"?t.name:t,i=typeof n=="object"?n.name:n;if(!b[r]||!b[r][i])return;const s=b[r][i],a=performance.now();if(!(a-s.last<250)){if(s.last=a,typeof s.callback=="function"){s.callback(e,t,n);return}s.callback.forEach(f=>{f(e,t,n)})}})}function Dn(e,t,n){if(b[e]||(b[e]={}),!b[e][t]){b[e][t]={},b[e][t].last=0,b[e][t].callback=n;return}if(typeof b[e][t].callback=="function"){const r=b[e][t].callback;b[e][t].callback=[r]}b[e][t].callback.push(n)}function kn(){J.step(1/60),J.clearForces()}let $=0,G=0;function En(){function e(){G+=1}function t(){G-=1}function n(){$-=1}function r(){$+=1}K(c.controlKeys.up,{onPressed:t,onReleased:e}),K(c.controlKeys.down,{onPressed:e,onReleased:t}),K(c.controlKeys.left,{onPressed:n,onReleased:r}),K(c.controlKeys.right,{onPressed:r,onReleased:n})}function Cn(e){addEventListener("pointermove",e,!1)}function An(e){removeEventListener("pointermove",e)}function He(e,t){if(!c.keys[e]){console.error("Unknown key index: "+e);return}const n=c.keys[e];n.includes(">")?cn(n,t):K(n,t)}const Ne=new re(0,0),ce=new it,_=c.ballRadius,et=c.minVelocity;let L,Y,ue,dt=()=>{console.warn("gUpdateMazePosition not set")};function zn(e){new st(e).load(c.textureDir+"ball/"+c.ballTextureFile,n=>{ue=n,ue.colorSpace=Ae},void 0,()=>{ue=o.errorTexture})}function Tn(e){typeof e=="function"&&(dt=e),Y=o.physicsWorld.createBody({type:"dynamic",position:Ne,awake:!1,fixedRotation:!0,userData:"ball"}),Y.createFixture({shape:new ln(Ne,_),restitution:.15,density:.2});const t=new rt(_),n=new Ut({map:ue});return L=new Pe(t,n),L.position.y=_,L.castShadow=!0,o.scene.add(L),[Y,L]}function _n(){if(Y.isAwake()){const i=Y.getLinearVelocity();i.mul(.98),Math.abs(i.x)<et&&Math.abs(i.y)<et&&(i.x=0,i.y=0)}const e=Y.getPosition(),t=e.y,n=e.x-L.position.x,r=t-L.position.z;if(n!==0||r!==0){L.position.set(e.x,_,t);const i=Math.sqrt(n*n+r*r);return dt(e.x,_,t,i),o.firstPersonModeActive||(ce.makeRotationZ(-n/_),L.matrix.premultiply(ce),ce.makeRotationX(r/_),L.matrix.premultiply(ce),L.rotation.setFromRotationMatrix(L.matrix)),!0}return!1}function Rn(){return _}function Fn(e){L.visible=!e}let ie,se,O,B=0,ft=()=>{console.warn("gUpdateMazePosition not set")},Z=null,pe=null,q=null;const De=new at(0,0,0,"YZX"),Hn=new re(0,0),ut=Math.PI/4,In=Math.sin(ut),$n=Math.cos(ut);function Gn(e){zn(e)}function pt(e){typeof e=="function"&&(ft=e),[se,ie]=Tn(e),O=new xe(16769248,c.playerLightLevel),O.castShadow=!1,o.scene.add(O),o.playerLight=O}function Ie(){if(Z!==null&&(ht(Z.x,Z.z),Z=null,pe!==null&&(gt(pe),pe=null),q!==null&&(o.firstPersonModeActive&&(De.setFromQuaternion(o.camera.quaternion),De.y-=q,o.camera.quaternion.setFromEuler(De),B+=q),q=null)),$!==0||G!==0){let t;if($!==0&&G!==0?t=new re($*$n,G*In):t=new re($,G),t.mul(c.keyForce),o.firstPersonModeActive){const n=Math.cos(B),r=Math.sin(B),i=n*t.x-r*t.y,s=r*t.x+n*t.y;t.x=i,t.y=s}Un(t)}o.playerLight.position.x=ie.position.x,o.playerLight.position.z=ie.position.z;const e=_n();return e&&(o.idleStartMs=0,o.idleMode=!1),!e&&!o.idleMode&&(o.idleStartMs===0?o.idleStartMs=Date.now():Date.now()-o.idleStartMs>c.idleTimeout*1e3&&(o.idleMode=!0)),e}function gt(e){se.setLinearVelocity(e)}function On(){return se.getLinearVelocity()}function yt(e){gt(Hn),ht(e.start.x,e.start.z),B=-e.start.angle,O.position.set(e.start.x,c.lightYpos,e.start.z),O.intensity=0}function ht(e,t){const n=Se();ie.position.set(e,n.y,t),se.setPosition({x:e,y:t}),ft(e,n.y,t,0)}function Wn(e,t=null,n=null){Z=e,pe=t,q=n}function Se(){return ie.position}function mt(){return Rn()}function Un(e){se.applyForceToCenter(e)}function xt(){return B}function wt(e){B=e}function $e(e){Fn(e)}const Yn="player.js",Bn=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Yn,deferredPositionUpdate:Wn,getAngle:xt,getCameraHeight:mt,getLinearVelocity:On,getPosition:Se,hideMesh:$e,loadAssets:Gn,setAngle:wt,setNewMaze:yt,setup:pt,update:Ie},Symbol.toStringTag,{value:"Module"}));let h;function Vn(e,t,n=document.body){o.renderUpdate=Be,o.cameraYpos=c.defaultCameraY,o.scene=new Yt,o.camera=new Bt(80,window.innerWidth/window.innerHeight),o.renderer=new Vt({antialias:!0}),o.renderer.shadowMap.enabled=c.enableShadows,o.renderer.shadowMap.type=Xt,n.appendChild(o.renderer.domElement),o.renderer.setPixelRatio(window.devicePixelRatio),o.renderer.setSize(e,t),window.addEventListener("resize",Zn),o.scene.background=new We(c.bgColour),h=new Kt(16777215,c.sunLightLevel),h.castShadow=!0,h.position.set(5,20,5),h.shadow.camera.left=-10,h.shadow.camera.right=10,h.shadow.camera.top=0,h.shadow.camera.bottom=-20,h.shadow.camera.near=10,h.shadow.camera.far=25,o.scene.add(h),o.fog=new Zt(c.bgColour,5,10),o.scene.fog=o.fog}function Be(e=!0){let t=!1;if(!o.orbitControlsEnabled){const n=Se();if(o.firstPersonModeActive)o.camera.position.x=n.x,o.camera.position.z=n.z;else{const r=n.x-o.camera.position.x,i=n.z-o.camera.position.z;if(r!==0||i!==0){t=!0;const s=o.mazeExited?c.cameraExitEase:c.cameraEase;s>=1||Math.abs(r)<.008&&Math.abs(i)<.008?(o.camera.position.x=n.x,o.camera.position.z=n.z):(o.camera.position.x+=r*s,o.camera.position.z+=i*s)}}}(e||t)&&o.renderer.render(o.scene,o.camera)}function Xn(){const e=.1*(c.playerLightLevel-o.playerLight.intensity),t=.1*(c.sunLightLevel-h.intensity);return o.playerLight.intensity+=e,h.intensity+=t,e<.01?(o.playerLight.intensity=c.playerLightLevel,o.exitLight.intensity=c.exitLightLevel,h.intensity=c.sunLightLevel,!0):!1}function Kn(){const e=.04*o.playerLight.intensity;return o.playerLight.intensity-=e,o.exitLight.intensity-=e,h.intensity-=e/2,e<.01?(o.playerLight.intensity=0,o.exitLight.intensity=0,h.intensity=0,!0):!1}function Zn(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight),Be()}var N=function(){var e=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(u){u.preventDefault(),r(++e%t.children.length)},!1);function n(u){return t.appendChild(u.dom),u}function r(u){for(var p=0;p<t.children.length;p++)t.children[p].style.display=p===u?"block":"none";e=u}var i=(performance||Date).now(),s=i,a=0,f=n(new N.Panel("FPS","#0ff","#002")),d=n(new N.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new N.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var u=(performance||Date).now();if(d.update(u-i,200),u>=s+1e3&&(f.update(a*1e3/(u-s),100),s=u,a=0,l)){var p=performance.memory;l.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:t,setMode:r}};N.Panel=function(e,t,n){var r=1/0,i=0,s=Math.round,a=s(window.devicePixelRatio||1),f=80*a,d=48*a,l=3*a,u=2*a,p=3*a,m=15*a,w=74*a,M=30*a,F=document.createElement("canvas");F.width=f,F.height=d,F.style.cssText="width:80px;height:48px";var g=F.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,f,d),g.fillStyle=t,g.fillText(e,l,u),g.fillRect(p,m,w,M),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(p,m,w,M),{dom:F,update:function(le,$t){r=Math.min(r,le),i=Math.max(i,le),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,f,m),g.fillStyle=t,g.fillText(s(le)+" "+e+" ("+s(r)+"-"+s(i)+")",l,u),g.drawImage(F,p+a,m,w-a,M,p,m,w-a,M),g.fillRect(p+w-a,m,a,M),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(p+w-a,m,a,s((1-le/$t)*M))}}};let ke=!1,D,ee,tt,we;function qn(){we=new N,document.body.appendChild(we.dom),He("orbit_controls",Qn),He("house_lights",Jn),D=new qt(o.camera,o.renderer.domElement),D.enableDamping=!0,D.enabled=!1,D.minPolarAngle=.02,D.maxPolarAngle=Math.PI-.05,ee=new jt(13421772,1),ee.intensity=0,o.scene.add(ee)}function jn(){return we&&we.update(),o.orbitControlsEnabled?(D.update(),!0):!1}function Qn(){if(o.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}o.orbitControlsEnabled=!o.orbitControlsEnabled;const e=Se();o.orbitControlsEnabled?(console.log("Orbit controls enabled"),tt=o.camera.position.y,D.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),o.camera.position.x=e.x,o.camera.position.y=tt,o.camera.position.z=e.z,o.camera.rotation.set(3*Math.PI/2,0,0),o.renderUpdate()),D.enabled=o.orbitControlsEnabled}function Jn(){ke=!ke,ke?(ee.intensity=1,o.scene.fog=null,console.log("House lights up")):(ee.intensity=0,o.scene.fog=o.fog,console.log("House lights down")),o.renderUpdate()}function Nn(){D&&D.target.set(o.camera.position.x,c.ballRadius,o.camera.position.z)}const H=new at(0,0,0,"YZX"),Ee=new Qt,eo="pointerLockElement"in document;let ge=0,ye=0;const Ge=Math.PI/2;function to(){if(!eo){console.log("browser does not support pointer lock, no first person view available");return}He("first_person",no),document.addEventListener("pointerlockchange",()=>{if(o.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}o.firstPersonModeActive?(document.exitPointerLock(),o.camera.rotation.set(-Ge,0,0),o.camera.position.y=o.cameraYpos=c.defaultCameraY,An(nt),$e(!1),o.firstPersonModeActive=!1,console.log("first person view disabled")):(o.camera.rotation.set(0,-xt(),0),o.camera.position.y=o.cameraYpos=mt(),Cn(nt),$e(!0),o.firstPersonModeActive=!0,console.log("first person view enabled")),o.renderUpdate()})}function no(){o.firstPersonModeActive?document.exitPointerLock():o.renderer.domElement.requestPointerLock()}function nt(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;ge=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*c.mouseSensitivity,ye=t*c.mouseSensitivity}function oo(){if(!o.firstPersonModeActive)return!1;let e=!1;return(ge!==0||ye!==0)&&(H.setFromQuaternion(o.camera.quaternion),H.x-=ge,H.y-=ye,H.x=Math.max(-Ge,Math.min(Ge,H.x)),o.camera.quaternion.setFromEuler(H),o.camera.getWorldDirection(Ee),wt(Math.atan2(Ee.x,-Ee.z)),ge=0,ye=0,e=!0),e}const j={},T={},R={},Q={};let te=null,Me=!1,Mt=!1;function ro(e){const t=new en(e);t.setResponseType("arraybuffer");for(const n in R)Object.hasOwn(R,n)&&t.load(c.soundsDir+R[n].filename,r=>{j[n]=r.transfer()})}function Ve(e){for(const t in e)if(Object.hasOwn(e,t)){const n=e[t];typeof n=="string"?R[t]={filename:n,volume:1}:typeof n=="object"&&n.filename&&(R[t]={filename:n.filename},R[t].volume=n.volume?n.volume:1)}}function Xe(e){for(const t in e)Object.hasOwn(e,t)&&(Q[t]=e[t])}function bt(){document.body.addEventListener("click",()=>{Me||vt()},{once:!0}),Mt=/firefox/i.test(navigator.userAgent),document.body.addEventListener("keydown",Lt,{once:!0})}function Lt(e){if(Mt&&e.key.length>1){Me||document.body.addEventListener("keydown",Lt,{once:!0});return}Me||vt()}function vt(){te=new Jt,o.camera.add(te);const e=new AudioContext;for(const t in j)Object.hasOwn(j,t)&&(T[t]||(T[t]=new Nt(te),e.decodeAudioData(j[t],n=>{T[t].setBuffer(n),T[t].setLoop(!1),T[t].setVolume(R[t].volume),delete j[t]})));Me=!0}function ae(e){return te===null?!0:T[e]?(T[e].isPlaying&&T[e].stop(),T[e].play(),!0):!1}function Pt(e){if(te===null)return!0;if(Q[e]){const t=Q[e].length;if(t>0){const n=Math.floor(Math.random()*t),r=Q[e][n];return ae(r)?!0:(Q[e].splice(n,1),!1)}else return!1}return!1}const io="sounds.js",so=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:io,addAssets:Ve,addGroups:Xe,loadAssets:ro,play:ae,playFromGroup:Pt,setup:bt},Symbol.toStringTag,{value:"Module"})),St=Math.PI/2,ao=new We(16711680),lo=new We(65280);let S,Ke,E,V,X,ne,v,k=null,Ze,qe,he,je=!1,be=!1;function Dt(){S=o.scene,Ke=o.exitLight,ne=new xe(16766720,0),S.add(ne),V=new xe(16766720,0),S.add(V),Ze=new ze(.5,.04),qe=new ze(.04,.5),o.physicsWorld.addContactCallback("ball","closed_door",()=>{ae("locked")}),je=!0}function co(e){const t=new tn(e);t.load(c.modelDir+c.keyModelFile,n=>{E=n.scene,E.traverse(r=>{r instanceof Pe&&(r.material.emissive={b:0,r:1,g:.7,isColor:!0},r.material.emissiveIntensity=.55)}),E.scale.set(.6,.6,.6)},void 0,()=>{E=o.errorMesh.clone()}),t.load(c.modelDir+c.baseModelFile,n=>{X=n.scene,X.scale.set(.35,.1,.35)},void 0,()=>{X=o.errorMesh.clone()}),t.load(c.modelDir+c.doorModelFile,n=>{v=n.scene,v.scale.set(.42,.4,.3)},void 0,()=>{v=o.errorMesh.clone()}),Ve(c.keySounds),Xe(c.keySoundGroups)}function kt(e){if(!je)return;k!==null&&(o.physicsWorld.destroyBody(k),k=null),S.remove(E),S.remove(X),S.remove(v),ne.intensity=0,V.intensity=0,be=!1;const t=e;if(he=t,t.deadends.length===0){t.key=!1,t.keyIndex=!1;return}const n=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[n],t.keyIndex=n,t.data[t.key.x][t.key.z]="K";const{x:r,z:i}=t.exit;t.data[r][i]="L";let s=t.exit.x,a=t.exit.z,f;t.exit.dir==="L"||t.exit.dir==="R"?(v.rotation.set(0,St,0),s+=t.exit.dir==="R"?.5:-.5,f=qe):(v.rotation.set(0,0,0),a+=t.exit.dir==="D"?.5:-.5,f=Ze);const d={type:"static",position:{x:s,y:a},userData:"closed_door"};k=o.physicsWorld.createBody(d),k.createFixture({shape:f}),X.position.set(t.key.x,0,t.key.z),S.add(X),ne.position.set(t.key.x,.1,t.key.z),ne.intensity=.04,E.position.set(t.key.x,.38,t.key.z),S.add(E),V.position.set(t.key.x,.44,t.key.z),V.intensity=.1,be=!0,v.position.set(s,0,a),S.add(v),Ke.color=ao}function Et(){return!je||!be||o.idleMode?!1:(E.rotateY(.03),E.rotateZ(.03),!0)}function Ct(){S.remove(E),V.intensity=0,be=!1,ae("keyPickup");const{x:e,z:t}=he.exit;he.data[e][t]="H",k!==null&&(o.physicsWorld.destroyBody(k),k=null);const n=he.exit.dir;let r=v.position.x,i=v.position.z,s,a=0;n==="L"||n==="R"?(r+=n==="R"?.5:-.5,i+=.5,s=Ze):(a=St,r+=.5,i+=n==="D"?.5:-.5,s=qe);const f={type:"static",position:{x:r,y:i},userData:"open_door"};k=o.physicsWorld.createBody(f),k.createFixture({shape:s}),v.position.set(r,0,i),v.rotation.set(0,a,0),Ke.color=lo}const fo="key.js",uo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:fo,collect:Ct,create:kt,loadAssets:co,setup:Dt,update:Et},Symbol.toStringTag,{value:"Module"})),ot=Math.PI/2,Le=[],ve=[],de=[],At=[],y={x:0,z:0,type:""};let W,me,oe,C,P,U,Oe=.9;function zt(){W=o.scene,me=o.camera,oe=new xe(65280,0),W.add(oe),o.exitLight=oe,U={size:{x:0,z:0}},o.physicsWorld.addContactCallback("ball","wall",e=>{const t=e.getManifold().localNormal,n=e.getFixtureB().getBody().getLinearVelocity(),r=Math.abs(n.x*t.x),i=Math.abs(n.y*t.y);(r>Oe||i>Oe)&&(ae("wallhit"),hn())})}function po(e){const t=new st(e);for(const n of c.wallTextureFiles)t.load(c.textureDir+"walls/"+n,r=>{r.colorSpace=Ae,Le.push(r)},void 0,()=>{Le.push(o.errorTexture)});for(const n of c.floorTextureFiles)t.load(c.textureDir+"floors/"+n,r=>{r.colorSpace=Ae,ve.push(r)},void 0,()=>{ve.push(o.errorTexture)});Ve(c.mazeSounds),Xe(c.mazeSoundGroups)}function Tt(e,t=.9){U=e,Oe=t;const n=Math.floor(Math.random()*Le.length);de.length>0&&(de.forEach(p=>o.physicsWorld.destroyBody(p)),de.length=0);const r={type:"static",position:{x:0,y:0},userData:"wall"},i=new ze(.5,.5);for(let p=0;p<e.size.x;p++)for(let m=0;m<e.size.z;m++)if(e.data[p][m]===!1){r.position={x:p,y:m};const w=o.physicsWorld.createBody(r);de.push(w),w.createFixture({shape:i})}const s=e.size.x,a=e.size.z;C&&(W.remove(C),C.geometry.dispose(),C.material.dispose(),C=null),P&&(W.remove(P),P.geometry.dispose(),P.material.dispose(),P=null),C=go(e,n),C.castShadow=!0,C.receiveShadow=!0,W.add(C);const f=Math.floor(Math.random()*ve.length),d=ve[f];d.wrapS=d.wrapT=nn,d.repeat.set(s+15,a+15);const l=new on(s+15,a+15),u=new lt({map:d});P=new Pe(l,u),P.rotateX(-ot),P.position.set((s-1)/2,0,(a-1)/2),P.receiveShadow=!0,W.add(P),o.firstPersonModeActive?me.rotation.set(0,e.start.angle,0):me.rotation.set(-ot,0,0),me.position.set(e.start.x,o.cameraYpos,e.start.z),oe.position.set(e.exit.x,c.exitLightY,e.exit.z),oe.intensity=0,o.mazeExited=!1}function go(e,t){const n=new rn(1,c.mazeHeight,1),r=Le[t],i=new lt({map:r}),s=new sn(n,i,e.size.x*e.size.z);s.count=0;const a=new it;for(let f=0;f<e.size.x;f++)for(let d=0;d<e.size.z;d++)e.data[f][d]===!1&&(a.setPosition(f,c.mazeHeight/2,d),s.setMatrixAt(s.count++,a));return s}function _t(e,t,n,r){mn(r);const i=Math.floor(e+.5),s=Math.floor(n+.5),a={x:y.x,z:y.z},f={x:e,z:n};if(i===a.x&&s===a.z)return;const d=y.type;y.x=i,y.z=s,i>=0&&i<U.size.x&&s>=0&&s<U.size.z?y.type=U.data[y.x][y.z]:y.type="O",y.type!==d&&(y.type==="K"&&(Ct(),U.data[y.x][y.z]="D"),At.forEach(l=>{(l.from===null||l.from===d)&&(l.to===null||l.to===y.type)&&l.callback(d,y.type,a,f)}))}function yo(e,t=null,n=null){At.push({from:n,to:t,callback:e})}function Rt(){return y}function Ft(){return!1}const ho="maze.js",mo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:ho,create:Tt,getPlayerGridInfo:Rt,loadAssets:po,registerOnTypeChange:yo,setup:zt,update:Ft,updatePlayerPosition:_t},Symbol.toStringTag,{value:"Module"}));Math.random=c.randomSeed?Te(c.randomSeed):Te();o.errorTexture=xn();o.errorMesh=wn();const x=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Ce=1,A=x.init,Ht=0;const{promise:xo,resolve:wo}=Promise.withResolvers();document.addEventListener("DOMContentLoaded",()=>{Ht=gn(),Fe("Loading..."),Mn([Bn,mo,uo,so],wo)});await xo;Mo();function Mo(){Sn(),Vn(window.innerWidth,window.innerHeight-Ht),En(),qn(),to(),zt(),Dt(),pt(_t),bt(),requestAnimationFrame(It)}function It(){let e=!0;switch(A){case x.init:{yn(Ce);const t=Math.random().toString().substring(2),n=5+Ce*2,r=vn(n,n,t);Tt(r),kt(r),yt(r),Nn(),A=x.fadeIn}break;case x.fadeIn:Xn()&&(A=x.play);break;case x.play:e=Ie(),e|=oo(),e|=Et(),e|=Ft(),Rt().type==="O"&&(Ce++,o.mazeExited=!0,A=x.fadeOut,Pt("mazeExit"));break;case x.fadeOut:Ie(),Kn()&&(A=x.pause);break;case x.pause:setTimeout(()=>{A=x.init},800),A=x.idle;break;case x.idle:break;default:console.log("game_loop(): Unknown game state: "+A),A=x.pause;break}e|=jn(),kn(),Be(e),requestAnimationFrame(It)}
