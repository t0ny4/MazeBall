import{N as $,G as Be}from"./keystrokes-zXtNIVHG.js";import{W as Ne,V as Y,C as qe,B as se}from"./planck-BHduNLkk.js";import{M as ve,T as Ee,S as ae,a as Ae,b as Qe,c as ee,P as N,d as Je,e as et,W as tt,f as ot,C as ue,D as nt,F as rt,G as it,R as st,g as at,h as Se,B as lt,I as ct,O as dt,A as ft,V as ut,E as pt,i as gt,j as ht,L as yt}from"./three-hkB4yEKb.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();function me(...e){let t,n,i,r;if(e.length===0){const s=new Uint32Array(3);window.crypto.getRandomValues(s),e=[s[0],s[1],s[2]]}a(e);function a(s){const c=f();t=c(" "),n=c(" "),i=c(" "),r=1;for(let u=0;u<s.length;u++)t-=c(s[u]),t<0&&(t+=1),n-=c(s[u]),n<0&&(n+=1),i-=c(s[u]),i<0&&(i+=1)}function f(){let s=4022871197;function c(u){u=u.toString();const Ve=u.length;for(let ne=0;ne<Ve;ne++){s+=u.charCodeAt(ne);let S=.02519603282416938*s;s=S>>>0,S-=s,S*=s,s=S>>>0,S-=s,s+=S*4294967296}return(s>>>0)*23283064365386963e-26}return c}function y(s){return parseInt(s,10)===s}function d(){const s=2091639*t+r*23283064365386963e-26;return t=n,n=i,i=s-(r=s|0),i}return d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.int32=function(){return d()*4294967296},d.cycle=function(s){s=typeof s>"u"?1:Number(s),s<1&&(s=1);for(let c=0;c<s;c++)d()},d.range=function(s=0,c=0){if(s===0&&c===0)return 0;if(s>c){const u=s;s=c,c=u}return y(s)&&y(c)?Math.floor(d()*(c-s+1))+s:d()*(c-s)+s},d.restart=function(){a(e)},d.seed=function(...s){a(s)},d}const mt={_MODULE:"global.js",cameraYpos:0,firstPersonModeActive:!1,mazeExited:!1,orbitControlsEnabled:!1,camera:null,exitLight:null,fog:null,physicsWorld:null,playerLight:null,renderer:null,renderUpdate:()=>{console.warn("global.renderUpdate not set")},scene:null,errorTexture:null,errorMesh:null},xt={get(e,t){if(t in e)return e[t];throw new Error("Global has no property named "+t)}},o=new Proxy(Object.seal(mt),xt),wt={_MODULE:"config.js",ballRadius:.3,bgColour:1048576,playerLightLevel:.9,textureDir:"./textures/128/",randomSeed:0,modelDir:"./models/",keyModelFile:"Key.glb",baseModelFile:"TeleporterBase.glb",doorModelFile:"ArchDoor.glb",ballTextureFile:"Tile1.png",minVelocity:.1,exitLightY:.4,floorTextureFiles:["Tile8.png","Tile16.png","Tile24.png","Tile25.png"],mazeHeight:1.2,wallTextureFiles:["Tile11.png","Tile4.png","Tile18.png","Tile20.png","Tile21.png","Tile23.png"],controlKeys:{up:["ArrowUp","w","k"],down:["ArrowDown","s","j"],left:["ArrowLeft","a","h"],right:["ArrowRight","d","l"]},keys:{orbit_controls:"control>enter",house_lights:"shift>enter",first_person:"+"},mouseSensitivity:.005,keyForce:.4,lightYpos:1.4,cameraEase:.08,cameraExitEase:.04,defaultCameraY:4,enableShadows:!0,exitLightLevel:.5,sunLightLevel:.4},Mt={get(e,t){if(t in e)return e[t];throw new Error("Config has no property named "+t)},set(e,t){throw new Error("Config is read only, attempted to write to property named "+t)}},l=new Proxy(Object.freeze(wt),Mt),bt=Math.PI/2;function Lt(e){const t=5+e*2,n=t,i={size:{x:t,z:n},data:Array.from({length:t},()=>Array(n).fill(!1)),deadends:[],key:!1},r=vt(i.size);return i.start=r.start,i.start.angle=0,i.end=r.end,i.exit=r.exit,i.data[i.exit.x][i.exit.z]="H",i}function Pt(e){const t=Lt(e);ke(t,t.start.x,t.start.z);const{x:n,z:i}=t.start;let r=0;if(t.data[n-1][i]!==!1?r=1:t.data[n][i+1]!==!1?r=2:t.data[n+1][i]!==!1&&(r=3),t.data[t.start.x][t.start.z]="S",t.data[t.end.x][t.end.z]="E",t.start.angle=r*bt,t.deadends.length>0){const a=Math.floor(Math.random()*t.deadends.length);t.key=t.deadends[a],t.data[t.key.x][t.key.z]="K"}return t}function ke(e,t,n){let i=t===e.end.x&&n===e.end.z;for(;;){const r=[];let a;if(n<e.size.z-3&&e.data[t][n+2]===!1&&r.push([0,1]),t<e.size.x-3&&e.data[t+2][n]===!1&&r.push([1,0]),n>2&&e.data[t][n-2]===!1&&r.push([0,-1]),t>2&&e.data[t-2][n]===!1&&r.push([-1,0]),r.length===0)return i?e.data[t][n]="*":e.data[t][n]===!1&&(e.data[t][n]="D",e.deadends.push({x:t,z:n})),i;if(e.data[t][n]=".",r.length===1?[a]=r:a=r[Math.floor(Math.random()*r.length)],ke(e,t+a[0]*2,n+a[1]*2)?(e.data[t+a[0]][n+a[1]]="*",i=!0):e.data[t+a[0]][n+a[1]]=".",r.length===1)return i&&(e.data[t][n]="*"),i}}function vt(e){const t={},n={};let i=Math.random()>.5,r=Math.random()>.5;t.x=r?1:e.x-2,t.z=i?1:e.z-2;const a=Math.random();a>.5?(i=!i,r=!r):a>.25?i=!i:r=!r,n.x=r?1:e.x-2;const f=r?-1:1;n.z=i?1:e.z-2;const y=i?-1:1,d={...n};return Math.random()>.5?(n.z+=y,n.dir=i?"U":"D"):(n.x+=f,n.dir=r?"L":"R"),{start:t,end:d,exit:n}}let D=0,C=0;function Et(){function e(){C+=1}function t(){C-=1}function n(){D-=1}function i(){D+=1}$(l.controlKeys.up,{onPressed:t,onReleased:e}),$(l.controlKeys.down,{onPressed:e,onReleased:t}),$(l.controlKeys.left,{onPressed:n,onReleased:i}),$(l.controlKeys.right,{onPressed:i,onReleased:n})}function At(e){addEventListener("pointermove",e,!1)}function St(e){removeEventListener("pointermove",e)}function le(e,t){if(!l.keys[e]){console.error("Unknown key index: "+e);return}const n=l.keys[e];n.includes(">")?Be(n,t):$(n,t)}let q;function kt(){q=new Ne({gravity:new Y(0,0)}),o.physicsWorld=q}function Dt(){q.step(1/60),q.clearForces()}const xe=new Y(0,0),j=new ve,A=l.ballRadius,we=l.minVelocity;let m,O,X,De=()=>{console.warn("gUpdateMazePosition not set")};function Ct(e){new Ee(e).load(l.textureDir+"ball/"+l.ballTextureFile,n=>{X=n,X.colorSpace=ae},void 0,()=>{X=o.errorTexture})}function zt(e){typeof e=="function"&&(De=e),O=o.physicsWorld.createBody({type:"dynamic",position:xe,awake:!1,fixedRotation:!0}),O.createFixture({shape:new qe(xe,A),restitution:.15,density:.2});const t=new Ae(A),n=new Qe({map:X});return m=new ee(t,n),m.position.y=A,m.castShadow=!0,o.scene.add(m),[O,m]}function Tt(){if(O.isAwake()){const r=O.getLinearVelocity();r.mul(.98),Math.abs(r.x)<we&&Math.abs(r.y)<we&&(r.x=0,r.y=0)}const e=O.getPosition(),t=e.y,n=e.x-m.position.x,i=t-m.position.z;return n!==0||i!==0?(m.position.set(e.x,A,t),De(e.x,A,t),o.firstPersonModeActive||(j.makeRotationZ(-n/A),m.matrix.premultiply(j),j.makeRotationX(i/A),m.matrix.premultiply(j),m.rotation.setFromRotationMatrix(m.matrix)),!0):!1}function Ft(){return A}function Ot(e){m.visible=!e}let H,te,z,G=0,Ce=()=>{console.warn("gUpdateMazePosition not set")};const _t=new Y(0,0),ze=Math.PI/4,Rt=Math.sin(ze),$t=Math.cos(ze);function Ut(e){Ct(e)}function Te(e){typeof e=="function"&&(Ce=e),[te,H]=zt(e),z=new N(16769248,l.playerLightLevel),z.castShadow=!1,o.scene.add(z),o.playerLight=z}function ce(){if(D!==0||C!==0){let e;if(D!==0&&C!==0?e=new Y(D*$t,C*Rt):e=new Y(D,C),e.mul(l.keyForce),o.firstPersonModeActive){const t=Math.cos(G),n=Math.sin(G),i=t*e.x-n*e.y,r=n*e.x+t*e.y;e.x=i,e.y=r}Yt(e)}return o.playerLight.position.x=H.position.x,o.playerLight.position.z=H.position.z,Tt()}function It(e){te.setLinearVelocity(e)}function Fe(e){It(_t),Wt(e.start.x,e.start.z),G=-e.start.angle,z.position.set(e.start.x,l.lightYpos,e.start.z),z.intensity=0}function Wt(e,t){const n=oe();H.position.set(e,n.y,t),te.setPosition({x:e,y:t}),Ce(e,n.y,t)}function oe(){return H.position}function Oe(){return Ft()}function Yt(e){te.applyForceToCenter(e)}function _e(){return G}function Re(e){G=e}function de(e){Ot(e)}const Ht="player.js",Gt=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:Ht,getAngle:_e,getCameraHeight:Oe,getPosition:oe,hideMesh:de,loadAssets:Ut,setAngle:Re,setNewMaze:Fe,setup:Te,update:ce},Symbol.toStringTag,{value:"Module"}));let p;function jt(e=document.body){o.renderUpdate=pe,o.cameraYpos=l.defaultCameraY,o.scene=new Je,o.camera=new et(80,window.innerWidth/window.innerHeight),o.renderer=new tt({antialias:!0}),o.renderer.shadowMap.enabled=l.enableShadows,o.renderer.shadowMap.type=ot,e.appendChild(o.renderer.domElement),o.renderer.setPixelRatio(window.devicePixelRatio),o.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",Zt),o.scene.background=new ue(l.bgColour),p=new nt(16777215,l.sunLightLevel),p.castShadow=!0,p.position.set(5,20,5),p.shadow.camera.left=-10,p.shadow.camera.right=10,p.shadow.camera.top=0,p.shadow.camera.bottom=-20,p.shadow.camera.near=10,p.shadow.camera.far=25,o.scene.add(p),o.fog=new rt(l.bgColour,5,10),o.scene.fog=o.fog}function pe(e=!0){let t=!1;if(!o.orbitControlsEnabled){const n=oe();if(o.firstPersonModeActive)o.camera.position.x=n.x,o.camera.position.z=n.z;else{const i=n.x-o.camera.position.x,r=n.z-o.camera.position.z;if(i!==0||r!==0){t=!0;const a=o.mazeExited?l.cameraExitEase:l.cameraEase;a>=1||Math.abs(i)<.008&&Math.abs(r)<.008?(o.camera.position.x=n.x,o.camera.position.z=n.z):(o.camera.position.x+=i*a,o.camera.position.z+=r*a)}}}(e||t)&&o.renderer.render(o.scene,o.camera)}function Kt(){const e=.1*(l.playerLightLevel-o.playerLight.intensity),t=.1*(l.sunLightLevel-p.intensity);return o.playerLight.intensity+=e,p.intensity+=t,e<.01?(o.playerLight.intensity=l.playerLightLevel,o.exitLight.intensity=l.exitLightLevel,p.intensity=l.sunLightLevel,!0):!1}function Xt(){const e=.04*o.playerLight.intensity;return o.playerLight.intensity-=e,o.exitLight.intensity-=e,p.intensity-=e/2,e<.01?(o.playerLight.intensity=0,o.exitLight.intensity=0,p.intensity=0,!0):!1}function Zt(){o.camera.aspect=window.innerWidth/window.innerHeight,o.camera.updateProjectionMatrix(),o.renderer.setSize(window.innerWidth,window.innerHeight),pe()}const $e=Math.PI/2,Vt=new ue(16711680),Bt=new ue(65280);let M,ge,b,_,R,U,x,L=null,he,ye,Ue,Ie=!1;function We(){M=o.scene,ge=o.exitLight,U=new N(16766720,0),M.add(U),_=new N(16766720,0),M.add(_),he=new se(.5,.04),ye=new se(.04,.5),Ie=!0}function Nt(e){const t=new it(e);t.load(l.modelDir+l.keyModelFile,n=>{b=n.scene,b.traverse(i=>{i instanceof ee&&(i.material.emissive={b:0,r:1,g:.7,isColor:!0},i.material.emissiveIntensity=.55)}),b.scale.set(.6,.6,.6),b.rotateZ(-.4),b.rotateY(.5)},void 0,()=>{b=o.errorMesh.clone()}),t.load(l.modelDir+l.baseModelFile,n=>{R=n.scene,R.scale.set(.35,.1,.35)},void 0,()=>{R=o.errorMesh.clone()}),t.load(l.modelDir+l.doorModelFile,n=>{x=n.scene,x.scale.set(.42,.4,.3)},void 0,()=>{x=o.errorMesh.clone()})}function Ye(e){if(!Ie||(Ue=e,L!==null&&(o.physicsWorld.destroyBody(L),L=null),M.remove(b),M.remove(R),M.remove(x),U.intensity=0,_.intensity=0,e.key===!1))return;let t=e.exit.x,n=e.exit.z,i;e.exit.dir==="L"||e.exit.dir==="R"?(x.rotation.set(0,$e,0),t+=e.exit.dir==="R"?.5:-.5,i=ye):(x.rotation.set(0,0,0),n+=e.exit.dir==="D"?.5:-.5,i=he);const r={type:"static",position:{x:t,y:n}};L=o.physicsWorld.createBody(r),L.createFixture({shape:i}),R.position.set(e.key.x,0,e.key.z),M.add(R),U.position.set(e.key.x,.1,e.key.z),U.intensity=.04,b.position.set(e.key.x,.3,e.key.z),M.add(b),_.position.set(e.key.x,.3,e.key.z),_.intensity=.1,x.position.set(t,0,n),M.add(x),ge.color=Vt}function He(){M.remove(b),_.intensity=0,L!==null&&(o.physicsWorld.destroyBody(L),L=null);const e=Ue.exit.dir;let t=x.position.x,n=x.position.z,i,r=0;e==="L"||e==="R"?(t+=e==="R"?.5:-.5,n+=.5,i=he):(r=$e,t+=.5,n+=e==="D"?.5:-.5,i=ye);const a={type:"static",position:{x:t,y:n}};L=o.physicsWorld.createBody(a),L.createFixture({shape:i}),x.position.set(t,0,n),x.rotation.set(0,r,0),ge.color=Bt}const qt="key.js",Qt=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:qt,collect:He,create:Ye,loadAssets:Nt,setup:We},Symbol.toStringTag,{value:"Module"})),Me=Math.PI/2,Q=[],J=[],K=[],g={x:0,z:0,type:""};let T,Z,I,v,w,F;function Ge(){T=o.scene,Z=o.camera,I=new N(65280,0),T.add(I),o.exitLight=I,F={size:{x:0,z:0}}}function Jt(e){const t=new Ee(e);for(const n of l.wallTextureFiles)t.load(l.textureDir+"walls/"+n,i=>{i.colorSpace=ae,Q.push(i)},void 0,()=>{Q.push(o.errorTexture)});for(const n of l.floorTextureFiles)t.load(l.textureDir+"floors/"+n,i=>{i.colorSpace=ae,J.push(i)},void 0,()=>{J.push(o.errorTexture)})}function je(e){F=e,K.length>0&&(K.forEach(s=>o.physicsWorld.destroyBody(s)),K.length=0);const t={type:"static",position:{x:0,y:0}},n=new se(.5,.5);for(let s=0;s<e.size.x;s++)for(let c=0;c<e.size.z;c++)if(e.data[s][c]===!1){t.position={x:s,y:c};const u=o.physicsWorld.createBody(t);K.push(u),u.createFixture({shape:n})}const i=e.size.x,r=e.size.z;v&&(T.remove(v),v.geometry.dispose(),v.material.dispose(),v=null),w&&(T.remove(w),w.geometry.dispose(),w.material.dispose(),w=null),v=eo(e),v.castShadow=!0,v.receiveShadow=!0,T.add(v);const a=Math.floor(Math.random()*J.length),f=J[a];f.wrapS=f.wrapT=st,f.repeat.set(i+15,r+15);const y=new at(i+15,r+15),d=new Se({map:f});w=new ee(y,d),w.rotateX(-Me),w.position.set((i-1)/2,0,(r-1)/2),w.receiveShadow=!0,T.add(w),o.firstPersonModeActive?Z.rotation.set(0,e.start.angle,0):Z.rotation.set(-Me,0,0),Z.position.set(e.start.x,o.cameraYpos,e.start.z),I.position.set(e.exit.x,l.exitLightY,e.exit.z),I.intensity=0,o.mazeExited=!1}function eo(e){const t=new lt(1,l.mazeHeight,1),n=Math.floor(Math.random()*Q.length),i=Q[n],r=new Se({map:i}),a=new ct(t,r,e.size.x*e.size.z);a.count=0;const f=new ve;for(let y=0;y<e.size.x;y++)for(let d=0;d<e.size.z;d++)e.data[y][d]===!1&&(f.setPosition(y,l.mazeHeight/2,d),a.setMatrixAt(a.count++,f));return a}function Ke(e,t,n){const i=Math.floor(e+.5),r=Math.floor(n+.5),a=g.x,f=g.z;if(i===a&&r===f)return;const y=g.type;g.x=i,g.z=r,i>=0&&i<F.size.x&&r>=0&&r<F.size.z?g.type=F.data[g.x][g.z]:g.type="O",g.type!==y&&g.type==="K"&&(He(),F.data[g.x][g.z]="D")}function Xe(){return g}const to="maze.js",oo=Object.freeze(Object.defineProperty({__proto__:null,_MODULE:to,create:je,getPlayerGridInfo:Xe,loadAssets:Jt,setup:Ge,updatePlayerPosition:Ke},Symbol.toStringTag,{value:"Module"}));let re=!1,P,W,be;function no(){le("orbit_controls",io),le("house_lights",so),P=new dt(o.camera,o.renderer.domElement),P.enableDamping=!0,P.enabled=!1,P.minPolarAngle=.02,P.maxPolarAngle=Math.PI-.05,W=new ft(13421772,1),W.intensity=0,o.scene.add(W)}function ro(){return o.orbitControlsEnabled?(P.update(),!0):!1}function io(){if(o.firstPersonModeActive){console.log("Cannot activate orbit controls while in first person view");return}o.orbitControlsEnabled=!o.orbitControlsEnabled;const e=oe();o.orbitControlsEnabled?(console.log("Orbit controls enabled"),be=o.camera.position.y,P.target.set(e.x,e.y,e.z)):(console.log("Orbit controls disabled"),o.camera.position.x=e.x,o.camera.position.y=be,o.camera.position.z=e.z,o.camera.rotation.set(3*Math.PI/2,0,0),o.renderUpdate()),P.enabled=o.orbitControlsEnabled}function so(){re=!re,re?(W.intensity=1,o.scene.fog=null,console.log("House lights up")):(W.intensity=0,o.scene.fog=o.fog,console.log("House lights down")),o.renderUpdate()}function ao(){P&&P.target.set(o.camera.position.x,l.ballRadius,o.camera.position.z)}const k=new pt(0,0,0,"YZX"),ie=new ut,lo="pointerLockElement"in document;let V=0,B=0;const fe=Math.PI/2;function co(){if(!lo){console.log("browser does not support pointer lock, first person view will not be available");return}le("first_person",fo),addEventListener("pointerlockchange",()=>{if(o.orbitControlsEnabled){document.pointerLockElement&&(console.log("Cannot switch to first person view while orbit controls are active"),document.exitPointerLock());return}o.firstPersonModeActive?(document.exitPointerLock(),o.camera.rotation.set(-fe,0,0),o.camera.position.y=o.cameraYpos=l.defaultCameraY,St(Le),de(!1),o.firstPersonModeActive=!1,console.log("first person view disabled")):(o.camera.rotation.set(0,-_e(),0),o.camera.position.y=o.cameraYpos=Oe(),At(Le),de(!0),o.firstPersonModeActive=!0,console.log("first person view enabled")),o.renderUpdate()})}function fo(){o.firstPersonModeActive?document.exitPointerLock():o.renderer.domElement.requestPointerLock()}function Le(e){const t=e.movementX||e.mozMovementX||e.webkitMovementX||0;V=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*l.mouseSensitivity,B=t*l.mouseSensitivity}function uo(){if(!o.firstPersonModeActive)return!1;let e=!1;return(V!==0||B!==0)&&(k.setFromQuaternion(o.camera.quaternion),k.x-=V,k.y-=B,k.x=Math.max(-fe,Math.min(fe,k.x)),o.camera.quaternion.setFromEuler(k),o.camera.getWorldDirection(ie),Re(Math.atan2(ie.x,-ie.z)),V=0,B=0,e=!0),e}Math.random=l.randomSeed?me(l.randomSeed):me();o.errorTexture=ho();o.errorMesh=yo();const h=Object.freeze({init:0,fadeIn:1,play:2,fadeOut:3,pause:4,idle:5});let Pe=1,E=h.init;document.addEventListener("DOMContentLoaded",()=>{po([Gt,oo,Qt],go)});function po(e,t){let n=!1,i=!1;const r=new yt;r.onError=a=>{console.warn("Failed to load asset:",a),i=!0},r.onLoad=()=>{n&&(i&&console.error("LoadingManager: finished loading asset files with errors"),t())},e.forEach(a=>{typeof a.loadAssets=="function"?a.loadAssets(r):console.warn(a,"has no loadAssets method")}),n=!0}function go(){kt(),jt(),Ge(),Te(Ke),We(),Et(),no(),co(),requestAnimationFrame(Ze)}function Ze(){let e=!0;switch(E){case h.init:{const t=Pt(Pe);je(t),Ye(t),Fe(t),ao(),E=h.fadeIn}break;case h.fadeIn:Kt()&&(E=h.play);break;case h.play:e=ce(),e|=uo(),Xe().type==="O"&&(Pe++,o.mazeExited=!0,E=h.fadeOut);break;case h.fadeOut:ce(),Xt()&&(E=h.pause);break;case h.pause:setTimeout(()=>{E=h.init},800),E=h.idle;break;case h.idle:break;default:console.log("game_loop(): Unknown game state: "+E),E=h.pause;break}e|=ro(),Dt(),pe(e),requestAnimationFrame(Ze)}function ho(){const n=new Uint8Array(1024);for(let r=0;r<1024;r+=4)n[r]=255,n[r+1]=105,n[r+2]=180,n[r+3]=255;const i=new gt(n,16,16);return i.needsUpdate=!0,i}function yo(){const e=new Ae(.1),t=new ht({color:16738740});return new ee(e,t)}
